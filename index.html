<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TOS ç­¾åè®¡ç®—å™¨</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.2.0/crypto-js.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.min.js"></script>
    <style>
        :root {
            /* AWSæ§åˆ¶å°æ‰å¹³åŒ–è®¾è®¡é¢œè‰²ç³»ç»Ÿ */
            --aws-blue: #232f3e;
            --aws-orange: #ff9900;
            --aws-light-blue: #418fca;
            --aws-gray-50: #fafafa;
            --aws-gray-100: #f2f3f3;
            --aws-gray-200: #eaeded;
            --aws-gray-300: #d5dbdb;
            --aws-gray-400: #aab7b8;
            --aws-gray-500: #85929e;
            --aws-gray-600: #5d6d7e;
            --aws-gray-700: #34495e;
            --aws-gray-800: #2c3e50;
            --aws-gray-900: #1b2631;
            --aws-white: #ffffff;
            --aws-red: #d13212;
            --aws-green: #037f0c;
            --aws-border: #d5dbdb;
            --aws-focus: #0073bb;
            --aws-hover: #f2f3f3;
        }

        * {
            box-sizing: border-box;
        }

        body {
            font-family: 'Amazon Ember', 'Helvetica Neue', Roboto, Arial, sans-serif;
            margin: 0;
            padding: 0;
            background-color: var(--aws-gray-50);
            color: var(--aws-gray-800);
            line-height: 1.5;
            font-size: 14px;
        }

        .main-container {
            max-width: 1600px;
            margin: 0 auto;
            padding: 20px;
        }

        .page-header {
            background: var(--aws-white);
            border: 1px solid var(--aws-border);
            border-radius: 4px;
            padding: 24px;
            margin-bottom: 20px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }

        .info-banner {
            background: #e7f3ff;
            border: 1px solid var(--aws-light-blue);
            border-radius: 4px;
            padding: 12px 16px;
            margin-bottom: 20px;
            font-size: 14px;
            color: var(--aws-gray-700);
            text-align: center;
            position: relative;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .info-banner a {
            color: var(--aws-light-blue);
            text-decoration: none;
            font-weight: 600;
        }

        .info-banner a:hover {
            text-decoration: underline;
        }

        .info-banner-close {
            position: absolute;
            right: 12px;
            top: 50%;
            transform: translateY(-50%);
            background: none;
            border: none;
            font-size: 16px;
            color: var(--aws-gray-500);
            cursor: pointer;
            padding: 4px;
            line-height: 1;
            border-radius: 2px;
        }

        .info-banner-close:hover {
            background: rgba(0, 0, 0, 0.1);
            color: var(--aws-gray-700);
        }

        .page-title {
            margin: 0;
            font-size: 28px;
            font-weight: 400;
            color: var(--aws-gray-900);
            line-height: 1.2;
        }

        .page-subtitle {
            margin: 8px 0 0;
            color: var(--aws-gray-600);
            font-size: 14px;
        }

        .main-layout {
            display: grid;
            grid-template-columns: 500px 1fr;
            gap: 20px;
            margin-bottom: 20px;
        }

        .input-panel {
            background: var(--aws-white);
            border: 1px solid var(--aws-border);
            border-radius: 4px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
            overflow: hidden;
        }

        .results-panel {
            background: var(--aws-white);
            border: 1px solid var(--aws-border);
            border-radius: 4px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
            overflow: hidden;
        }

        .form-section {
            padding: 24px;
        }

        .section-title {
            font-size: 18px;
            font-weight: 600;
            color: var(--aws-gray-900);
            margin: 0 0 16px 0;
            padding-bottom: 8px;
            border-bottom: 2px solid var(--aws-gray-200);
        }

        .form-grid {
            display: grid;
            grid-template-columns: 1fr;
            gap: 16px;
            margin-bottom: 24px;
        }

        .flowchart-section {
            background: var(--aws-white);
            border: 1px solid var(--aws-border);
            border-radius: 4px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
            overflow: hidden;
        }

        .form-group {
            margin-bottom: 16px;
        }

        .form-label {
            display: block;
            margin-bottom: 4px;
            font-weight: 600;
            color: var(--aws-gray-700);
            font-size: 14px;
        }

        .form-input, .form-select, .form-textarea {
            width: 100%;
            padding: 8px 12px;
            border: 1px solid var(--aws-border);
            border-radius: 4px;
            font-size: 14px;
            background-color: var(--aws-white);
            color: var(--aws-gray-800);
            transition: border-color 0.15s ease-in-out, box-shadow 0.15s ease-in-out;
        }

        .form-input:focus, .form-select:focus, .form-textarea:focus {
            outline: none;
            border-color: var(--aws-focus);
            box-shadow: 0 0 0 2px rgba(0, 115, 187, 0.2);
        }

        .form-textarea {
            height: 80px;
            resize: vertical;
            font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace;
        }

        .form-help {
            font-size: 12px;
            color: var(--aws-gray-500);
            margin-top: 4px;
        }

        .method-warning {
            font-size: 12px;
            color: var(--aws-red);
            background-color: #ffeaea;
            border: 1px solid #ffcdd2;
            border-radius: 4px;
            padding: 8px 12px;
            margin-top: 8px;
            font-weight: 600;
        }

        .host-process-info {
            font-size: 12px;
            color: var(--aws-green);
            background-color: #e8f5e8;
            border: 1px solid #4caf50;
            border-radius: 4px;
            padding: 12px;
            margin-top: 8px;
            position: relative;
        }

        .host-process-info .original-url {
            font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace;
            background-color: rgba(76, 175, 80, 0.1);
            padding: 4px 6px;
            border-radius: 3px;
            word-break: break-all;
            margin-bottom: 6px;
            display: block;
            font-weight: 500;
        }

        .host-process-info .process-details {
            font-weight: 600;
        }

        .host-process-close {
            position: absolute;
            right: 8px;
            top: 8px;
            background: none;
            border: none;
            color: var(--aws-green);
            font-size: 14px;
            cursor: pointer;
            padding: 2px 6px;
            border-radius: 2px;
            line-height: 1;
            font-weight: bold;
        }

        .host-process-close:hover {
            background-color: rgba(76, 175, 80, 0.2);
        }

        .expandable-section {
            border: 1px solid var(--aws-border);
            border-radius: 4px;
            margin-bottom: 16px;
        }

        .expandable-header {
            background-color: var(--aws-gray-100);
            padding: 12px 16px;
            border-bottom: 1px solid var(--aws-border);
            font-weight: 600;
            color: var(--aws-gray-700);
        }

        .expandable-content {
            padding: 16px;
            background-color: var(--aws-white);
        }

        .param-row {
            display: flex;
            gap: 12px;
            margin-bottom: 8px;
            align-items: center;
        }

        .param-row .form-input {
            flex: 1;
            margin: 0;
        }

        .btn {
            border: none;
            border-radius: 4px;
            padding: 8px 16px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.15s ease-in-out;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            text-decoration: none;
        }

        .btn-primary {
            background-color: var(--aws-light-blue);
            color: var(--aws-white);
            border: 1px solid var(--aws-light-blue);
        }

        .btn-primary:hover {
            background-color: #e88400;
            border-color: #e88400;
        }

        .btn-secondary {
            background-color: var(--aws-white);
            color: var(--aws-gray-700);
            border: 1px solid var(--aws-border);
        }

        .btn-secondary:hover {
            background-color: var(--aws-hover);
        }

        .btn-danger {
            background-color: var(--aws-red);
            color: var(--aws-white);
            border: 1px solid var(--aws-red);
        }

        .btn-danger:hover {
            background-color: #b02a0c;
            border-color: #b02a0c;
        }

        .btn-sm {
            padding: 6px 12px;
            font-size: 12px;
        }

        .btn-full {
            width: auto;
            padding: 12px 32px;
            font-size: 16px;
            margin-top: 24px;
        }

        .results-container {
            margin-top: 20px;
            display: grid;
            grid-template-columns: 1fr;
            gap: 20px;
        }

        .results-panel {
            background: var(--aws-white);
            border: 1px solid var(--aws-border);
            border-radius: 4px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
            overflow: hidden;
        }

        .panel-header {
            background-color: var(--aws-gray-100);
            padding: 16px 20px;
            border-bottom: 1px solid var(--aws-border);
            font-size: 16px;
            font-weight: 600;
            color: var(--aws-gray-900);
        }

        .panel-content {
            padding: 0;
        }

        .flowchart-container {
            padding: 20px;
            text-align: center;
            background-color: var(--aws-white);
        }

        .output-item {
            padding: 16px 20px;
            border-bottom: 1px solid var(--aws-gray-200);
        }

        .output-item:last-child {
            border-bottom: none;
        }

        .output-label {
            font-weight: 600;
            color: var(--aws-gray-700);
            margin-bottom: 8px;
            font-size: 14px;
        }

        .output-value {
            font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace;
            background-color: var(--aws-gray-50);
            padding: 12px;
            border-radius: 4px;
            border: 1px solid var(--aws-border);
            white-space: pre-wrap;
            word-break: break-all;
            font-size: 12px;
            color: var(--aws-gray-800);
            line-height: 1.4;
        }

        .notification {
            background-color: #d4efe7;
            border: 1px solid var(--aws-green);
            color: #0f5132;
            padding: 12px 16px;
            border-radius: 4px;
            margin-bottom: 20px;
            display: none;
            font-size: 14px;
        }

        .node-details {
            background-color: #e7f3ff;
            border: 1px solid var(--aws-light-blue);
            border-radius: 4px;
            padding: 16px;
            margin: 16px 20px 20px;
            display: none;
            text-align: left;
        }

        .node-details h4 {
            margin: 0 0 12px 0;
            color: var(--aws-gray-800);
            font-size: 16px;
            font-weight: 600;
        }

        .node-details pre {
            margin: 0;
            white-space: pre-wrap;
            word-wrap: break-word;
            font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace;
            font-size: 13px;
            line-height: 1.4;
            color: var(--aws-gray-700);
            background: none;
            border: none;
            padding: 0;
        }

        .timestamp-info {
            font-size: 12px;
            color: var(--aws-gray-500);
            margin-top: 4px;
        }

        /* æ»šåŠ¨æ¡æ ·å¼ */
        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }

        ::-webkit-scrollbar-track {
            background: var(--aws-gray-100);
        }

        ::-webkit-scrollbar-thumb {
            background: var(--aws-gray-400);
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: var(--aws-gray-500);
        }

        /* è¡¨æ ¼æ ·å¼ä¼˜åŒ– */
        .table-container {
            overflow-x: auto;
        }

        .data-table {
            width: 100%;
            border-collapse: collapse;
            font-size: 14px;
        }

        .data-table th,
        .data-table td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid var(--aws-border);
        }

        .data-table th {
            background-color: var(--aws-gray-100);
            font-weight: 600;
            color: var(--aws-gray-700);
        }

        /* Tab æ ‡ç­¾é¡µæ ·å¼ */
        .tab-container {
            background: var(--aws-white);
            border: 1px solid var(--aws-border);
            border-radius: 4px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
            overflow: hidden;
        }

        .tab-header {
            background-color: var(--aws-gray-100);
            border-bottom: 1px solid var(--aws-border);
            display: flex;
            align-items: center;
            padding: 0;
            margin: 0;
        }

        .tab-header-title {
            padding: 16px 20px;
            font-size: 16px;
            font-weight: 600;
            color: var(--aws-gray-900);
            border-right: 1px solid var(--aws-border);
            background-color: var(--aws-gray-100);
            flex-shrink: 0;
        }

        .tab-nav {
            display: flex;
            flex: 1;
            background-color: var(--aws-white);
        }

        .tab-button {
            background: none;
            border: none;
            padding: 12px 20px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
            color: var(--aws-gray-600);
            border-right: 1px solid var(--aws-border);
            transition: all 0.2s ease;
            position: relative;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .tab-button:hover {
            background-color: var(--aws-hover);
            color: var(--aws-gray-800);
        }

        .tab-button.active {
            background-color: var(--aws-white);
            color: var(--aws-light-blue);
            font-weight: 600;
        }

        .tab-button.active::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            height: 3px;
            background-color: var(--aws-light-blue);
        }

        .tab-button:last-child {
            border-right: none;
        }

        .tab-lang-icon {
            width: 16px;
            height: 16px;
            font-size: 12px;
            font-weight: bold;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            border-radius: 2px;
            color: white;
        }

        .tab-lang-icon.python {
            background-color: #3776ab;
        }

        .tab-lang-icon.golang {
            background-color: #00add8;
        }

        .tab-lang-icon.java {
            background-color: #ed8b00;
        }

        .tab-lang-icon.nodejs {
            background-color: #339933;
        }

        .tab-content {
            background-color: var(--aws-white);
        }

        .tab-pane {
            display: none;
            padding: 0;
        }

        .tab-pane.active {
            display: block;
        }

        .code-content {
            padding: 20px;
        }

        .code-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 12px;
            padding-bottom: 8px;
            border-bottom: 1px solid var(--aws-gray-200);
        }

        .code-title {
            font-weight: 600;
            color: var(--aws-gray-700);
            font-size: 14px;
            margin: 0;
        }

        .code-actions {
            display: flex;
            gap: 8px;
        }
    </style>
</head>
<body>
    <div class="main-container">
        <div class="info-banner" id="info-banner">
            <span>å¦‚æœ‰bugï¼Œæ¬¢è¿å‰å¾€ <a href="https://github.com/jneless/tos-sign-online" target="_blank">https://github.com/jneless/tos-sign-online</a> æissue</span>
            <button class="info-banner-close" onclick="closeInfoBanner()" title="å…³é—­">Ã—</button>
        </div>
        
        <div class="page-header">
            <h1 class="page-title">TOS ç­¾åè®¡ç®—å™¨</h1>
            <p class="page-subtitle">åœ¨çº¿è®¡ç®— TOS API ç­¾åï¼Œå•é¡µåº”ç”¨ï¼Œçº¯å‰ç«¯ javascript è¿è¡Œ</p>
            <p class="page-subtitle">é‡‡ç”¨ Github + Vercel è‡ªåŠ¨åŒ–æ„å»ºï¼Œæºç åœ¨Githubå¯è§ï¼Œä¸ä¼šä¿å­˜AK/SK</p>
            <div style="margin-top: 16px;">
                <button type="button" class="btn btn-sm" onclick="fillGetObjectDemo()" style="background-color: var(--aws-orange); color: var(--aws-white); border: 1px solid var(--aws-orange);"> â†˜ï¸ â†˜ï¸ â†˜ï¸ [ç‚¹è¿™é‡Œ]  å¸®æˆ‘æ„é€ ä¸€ä¸ª GetObject è¯·æ±‚ </button>
            </div>
        </div>
        
        <div class="main-layout">
            <!-- å·¦ä¾§è¾“å…¥é¢æ¿ -->
            <div class="input-panel">
                <div class="form-section">
                    <div id="notification" class="notification"></div>
                    
                    <form id="signatureForm">
                        <div class="section-title">åŸºç¡€é…ç½®</div>
                        <div class="form-grid">
                            <div class="form-group">
                                <label class="form-label" for="accessKey">Access Key</label>
                                <input class="form-input" type="text" id="accessKey" required>
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label" for="secretKey">Secret Key</label>
                                <input class="form-input" type="text" id="secretKey" required>
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label" for="region">Region</label>
                                <input class="form-input" type="text" id="region" value="cn-beijing" required>
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label" for="service">Service</label>
                                <input class="form-input" type="text" id="service" value="tos" required>
                                <div class="form-help">é»˜è®¤ä¸º tos</div>
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label" for="host">Host</label>
                                <input class="form-input" type="text" id="host" placeholder="example.tos-cn-beijing.volces.com" required onblur="processHostInput()">
                                <div class="form-help">é€šå¸¸æ˜¯ tos-${region}.volces.com æˆ–è€…æ˜¯ ${bucketname}.tos-${region}.volces.com çš„å½¢å¼ï¼Œå¿½ç•¥httpæˆ–httpsçš„å‰ç¼€ï¼Œç»“å°¾ä¸å«/</div>
                                <div id="hostProcessInfo" class="host-process-info" style="display: none;"></div>
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label" for="path">Path</label>
                                <input class="form-input" type="text" id="path" value="/" required>
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label" for="method">HTTP Method</label>
                                <select class="form-select" id="method" required onchange="checkMethodBodyConflict()">
                                    <option value="GET">GET</option>
                                    <option value="POST">POST</option>
                                    <option value="PUT">PUT</option>
                                    <option value="DELETE">DELETE</option>
                                    <option value="HEAD">HEAD</option>
                                </select>
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label" for="requestBody">Request Body</label>
                                <textarea class="form-textarea" id="requestBody" placeholder="è¯·æ±‚ä½“å†…å®¹ï¼ˆJSONç­‰ï¼‰" oninput="checkMethodBodyConflict()"></textarea>
                                <div id="methodBodyWarning" class="method-warning" style="display: none;">
                                    âš ï¸ å½“å‰Methodä¸ºGETï¼Œè¯·ä»”ç»†æ£€æŸ¥
                                </div>
                            </div>
                        </div>

                        <div class="section-title">æ—¶é—´æˆ³é…ç½®</div>
                        <div class="form-group">
                            <label class="form-label" for="timestampType">æ—¶é—´æˆ³è¾“å…¥æ–¹å¼</label>
                            <select class="form-select" id="timestampType" onchange="toggleTimestampInput()">
                                <option value="current">ä½¿ç”¨å½“å‰æ—¶é—´</option>
                                <option value="datetime">é€‰æ‹©æ—¥æœŸæ—¶é—´</option>
                                <option value="direct">ç›´æ¥è¾“å…¥TOSæ ¼å¼</option>
                            </select>
                        </div>
                        
                        <div class="form-group" id="datetimeInput" style="display: none;">
                            <label class="form-label" for="customTimestamp">é€‰æ‹©æ—¥æœŸæ—¶é—´</label>
                            <input class="form-input" type="datetime-local" id="customTimestamp" 
                                   step="1"
                                   title="æ”¯æŒç²¾ç¡®åˆ°ç§’">
                        </div>
                        
                        <div class="form-group" id="directInput" style="display: none;">
                            <label class="form-label" for="directTimestamp">TOSæ—¶é—´æˆ³æ ¼å¼</label>
                            <input class="form-input" type="text" id="directTimestamp" 
                                   placeholder="20250812T142648Z"
                                   pattern="[0-9]{8}T[0-9]{6}Z"
                                   title="æ ¼å¼: YYYYMMDDTHHMMSSZ">
                            <div class="form-help">æ ¼å¼: YYYYMMDDTHHMMSSZ</div>
                        </div>

                        <div class="section-title">Query Parameters (å¯é€‰)</div>
                        <div class="expandable-section">
                            <div class="expandable-header">æŸ¥è¯¢å‚æ•°</div>
                            <div class="expandable-content">
                                <div id="queryParams">
                                    <div class="param-row">
                                        <input class="form-input param-key" type="text" placeholder="å‚æ•°å">
                                        <input class="form-input param-value" type="text" placeholder="å‚æ•°å€¼">
                                        <button type="button" class="btn btn-danger btn-sm" onclick="removeParam(this)">åˆ é™¤</button>
                                    </div>
                                </div>
                                <button type="button" class="btn btn-secondary btn-sm" onclick="addParam()">æ·»åŠ å‚æ•°</button>
                                <div class="form-help">é»˜è®¤ä¸ºç©ºï¼Œå¦‚ä¸éœ€è¦å¯ä»¥ä¸å¡«</div>
                            </div>
                        </div>

                        <div class="section-title">Custom Headers (å¯é€‰)</div>
                        <div class="expandable-section">
                            <div class="expandable-header">è‡ªå®šä¹‰Headers</div>
                            <div class="expandable-content">
                                <div id="customHeaders">
                                    <div class="param-row">
                                        <input class="form-input header-key" type="text" placeholder="Header Name (å¦‚: x-tos-meta-example)">
                                        <input class="form-input header-value" type="text" placeholder="Header Value">
                                        <button type="button" class="btn btn-danger btn-sm" onclick="removeHeader(this)">åˆ é™¤</button>
                                    </div>
                                </div>
                                <button type="button" class="btn btn-secondary btn-sm" onclick="addHeader()">æ·»åŠ Header</button>
                                <div class="form-help">è‡ªåŠ¨åŒ…å«å¿…éœ€çš„ headers: host, x-tos-date, x-tos-content-sha256</div>
                            </div>
                        </div>
                        
                        <button type="submit" class="btn btn-primary btn-full">è®¡ç®—ç­¾å</button>
                    </form>
                </div>
            </div>
            
            <!-- å³ä¾§ç»“æœé¢æ¿ -->
            <div class="results-panel" id="results-panel" style="display: none;">
                <div class="panel-header">ç­¾åè®¡ç®—è¿‡ç¨‹</div>
                <div class="panel-content">
                    <div class="output-item">
                        <div class="output-label">1. åŸºç¡€å‚æ•°</div>
                        <div class="output-value" id="basicParamsOutput"></div>
                    </div>
                    
                    <div class="output-item">
                        <div class="output-label">2. æ—¶é—´æˆ³å¤„ç†</div>
                        <div class="output-value" id="timestampOutput"></div>
                    </div>
                    
                    <div class="output-item">
                        <div class="output-label">3. Payload Hash è®¡ç®—</div>
                        <div class="output-value" id="payloadHashOutput"></div>
                    </div>
                    
                    <div class="output-item">
                        <div class="output-label">4. Query Parameters å¤„ç†</div>
                        <div class="output-value" id="queryParamsOutput"></div>
                    </div>
                    
                    <div class="output-item">
                        <div class="output-label">5. Headers å¤„ç†</div>
                        <div class="output-value" id="headersToSignOutput"></div>
                    </div>
                    
                    <div class="output-item">
                        <div class="output-label">6. Canonical Request æ„é€ </div>
                        <div class="output-value" id="canonicalRequestOutput"></div>
                    </div>
                    
                    <div class="output-item">
                        <div class="output-label">7. String To Sign æ„é€ </div>
                        <div class="output-value" id="stringToSignOutput"></div>
                    </div>
                    
                    <div class="output-item">
                        <div class="output-label">8. å¯†é’¥æ´¾ç”Ÿè¿‡ç¨‹</div>
                        <div class="output-value" id="keyDerivationOutput"></div>
                    </div>
                    
                    <div class="output-item">
                        <div class="output-label">9. æœ€ç»ˆç­¾å</div>
                        <div class="output-value" id="signatureOutput"></div>
                    </div>
                    
                    <div class="output-item">
                        <div class="output-label">10. Authorization Header</div>
                        <div class="output-value" id="authHeaderOutput"></div>
                    </div>
                    
                    <div class="output-item">
                        <div class="output-label">11. å®Œæ•´çš„ cURL è¯·æ±‚</div>
                        <div class="output-value" id="curlRequestOutput"></div>
                        <div class="form-help">
                            ã€é‡è¦ã€‘å½“æ‰§è¡Œ curl å‘½ä»¤æ—¶ï¼Œå¦‚æœå‡ºç° "Warning: Binary output can mess up your terminal." è­¦å‘Šï¼Œè¿™è¡¨æ˜ <strong>ç­¾åå·²ç»é€šè¿‡éªŒè¯æˆåŠŸ</strong>ï¼å¦‚æœå¸Œæœ›ä¸‹è½½æ–‡ä»¶è¿›è¡Œæ ¡éªŒï¼Œè¯·æ‰‹åŠ¨åœ¨curlå‘½ä»¤æœ«å°¾æ·»åŠ  <strong>--output filename</strong> å‚æ•°æ¥ä¿å­˜æ–‡ä»¶ï¼Œæˆ–æ·»åŠ  <strong>--output -</strong> å¼ºåˆ¶è¾“å‡ºäºŒè¿›åˆ¶åˆ°ç»ˆç«¯
                        </div>
                        <div style="margin-top: 8px;">
                            <button type="button" class="btn btn-secondary btn-sm" onclick="copyCurl()" id="copyCurlBtn">å¤åˆ¶ cURL å‘½ä»¤</button>
                        </div>
                    </div>
                    
                    <div class="output-item">
                        <div class="output-label">12. æ¨å¹¿ä¿¡æ¯</div>
                        <div class="output-value" style="background-color: #f0f8ff; border-left: 4px solid #2196f3; padding: 12px;">
                            ğŸ‰ å¦‚æœæ‚¨è§‰å¾—è¿™ä¸ªå·¥å…·å¥½ç”¨ï¼Œæ¬¢è¿å‰å¾€ <a href="https://github.com/jneless/tos-sign-online/issues/new" style="color: #2196f3; text-decoration: none; font-weight: 600;" target="_blank">GitHub Issues</a> æ”¯æŒä¸€ä¸‹ï¼
                            <br>
                            ğŸ’ªğŸ» æ„Ÿè°¢ç«å±±å¼•æ“ L2 æŠ€æœ¯æ”¯æŒå›¢é˜Ÿ
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- åº•éƒ¨æµç¨‹å›¾åŒºåŸŸ -->
        <div class="flowchart-section" id="flowchart-section" style="display: none;">
            <div class="panel-header">TOS ç­¾åè®¡ç®—æµç¨‹å›¾</div>
            <div class="panel-content">
                <div class="flowchart-container">
                    <div class="mermaid" id="signature-flowchart">
                        <!-- æµç¨‹å›¾å°†åœ¨è¿™é‡Œæ¸²æŸ“ -->
                    </div>
                    <div id="node-details" class="node-details">
                        <strong>èŠ‚ç‚¹è¯¦ç»†ä¿¡æ¯</strong>
                        <div id="node-content"></div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- ä»£ç ç¤ºä¾‹åŒºåŸŸ -->
        <div class="tab-container" id="code-examples-section" style="display: none;">
            <div class="tab-header">
                <div class="tab-header-title">å®Œæ•´ä»£ç å®ç°ç¤ºä¾‹</div>
                <div class="tab-nav">
                    <button class="tab-button active" data-tab="python" onclick="switchTab('python')">
                        <span class="tab-lang-icon python">Py</span>
                        Python3
                    </button>
                    <button class="tab-button" data-tab="golang" onclick="switchTab('golang')">
                        <span class="tab-lang-icon golang">Go</span>
                        Golang
                    </button>
                    <button class="tab-button" data-tab="java" onclick="switchTab('java')">
                        <span class="tab-lang-icon java">Ja</span>
                        Java
                    </button>
                    <button class="tab-button" data-tab="nodejs" onclick="switchTab('nodejs')">
                        <span class="tab-lang-icon nodejs">Js</span>
                        Node.js
                    </button>
                </div>
            </div>
            
            <div class="tab-content">
                <!-- Python ä»£ç ç¤ºä¾‹ -->
                <div class="tab-pane active" id="python-tab">
                    <div class="code-content">
                        <div class="code-header">
                            <h4 class="code-title">Python3 å®Œæ•´å®ç° - ä½¿ç”¨ requests åº“</h4>
                            <div class="code-actions">
                                <button type="button" class="btn btn-secondary btn-sm" onclick="copyCode('python')" id="copyPythonBtn">å¤åˆ¶ä»£ç </button>
                            </div>
                        </div>
                        <div class="output-value" id="pythonCodeOutput"></div>
                    </div>
                </div>
                
                <!-- Golang ä»£ç ç¤ºä¾‹ -->
                <div class="tab-pane" id="golang-tab">
                    <div class="code-content">
                        <div class="code-header">
                            <h4 class="code-title">Golang å®Œæ•´å®ç° - ä½¿ç”¨æ ‡å‡†åº“</h4>
                            <div class="code-actions">
                                <button type="button" class="btn btn-secondary btn-sm" onclick="copyCode('golang')" id="copyGolangBtn">å¤åˆ¶ä»£ç </button>
                            </div>
                        </div>
                        <div class="output-value" id="golangCodeOutput"></div>
                    </div>
                </div>
                
                <!-- Java ä»£ç ç¤ºä¾‹ -->
                <div class="tab-pane" id="java-tab">
                    <div class="code-content">
                        <div class="code-header">
                            <h4 class="code-title">Java å®Œæ•´å®ç° - ä½¿ç”¨ HttpClient (Java 11+)</h4>
                            <div class="code-actions">
                                <button type="button" class="btn btn-secondary btn-sm" onclick="copyCode('java')" id="copyJavaBtn">å¤åˆ¶ä»£ç </button>
                            </div>
                        </div>
                        <div class="output-value" id="javaCodeOutput"></div>
                    </div>
                </div>
                
                <!-- Node.js ä»£ç ç¤ºä¾‹ -->
                <div class="tab-pane" id="nodejs-tab">
                    <div class="code-content">
                        <div class="code-header">
                            <h4 class="code-title">Node.js å®Œæ•´å®ç° - ä½¿ç”¨å†…ç½®æ¨¡å—</h4>
                            <div class="code-actions">
                                <button type="button" class="btn btn-secondary btn-sm" onclick="copyCode('nodejs')" id="copyNodejsBtn">å¤åˆ¶ä»£ç </button>
                            </div>
                        </div>
                        <div class="output-value" id="nodejsCodeOutput"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // å…³é—­ä¿¡æ¯æ¨ªå¹…
        function closeInfoBanner() {
            document.getElementById('info-banner').style.display = 'none';
        }

        // Tab åˆ‡æ¢åŠŸèƒ½
        function switchTab(tabName) {
            // ç§»é™¤æ‰€æœ‰tabæŒ‰é’®çš„activeç±»
            const tabButtons = document.querySelectorAll('.tab-button');
            tabButtons.forEach(button => {
                button.classList.remove('active');
            });
            
            // éšè—æ‰€æœ‰tabå†…å®¹
            const tabPanes = document.querySelectorAll('.tab-pane');
            tabPanes.forEach(pane => {
                pane.classList.remove('active');
            });
            
            // æ¿€æ´»å½“å‰é€‰ä¸­çš„tabæŒ‰é’®
            const activeButton = document.querySelector(`[data-tab="${tabName}"]`);
            if (activeButton) {
                activeButton.classList.add('active');
            }
            
            // æ˜¾ç¤ºå½“å‰é€‰ä¸­çš„tabå†…å®¹
            const activePane = document.getElementById(`${tabName}-tab`);
            if (activePane) {
                activePane.classList.add('active');
            }
        }

        // å¡«å…… GetObject æ¼”ç¤ºæ•°æ®
        function fillGetObjectDemo() {
            // å¡«å……åŸºç¡€é…ç½®
            document.getElementById('accessKey').value = 'your-access-key-here';
            document.getElementById('secretKey').value = 'your-secret-key-here';
            document.getElementById('region').value = 'cn-beijing';
            document.getElementById('service').value = 'tos';
            document.getElementById('host').value = 'your-bucket-name.tos-cn-beijing.volces.com';
            document.getElementById('path').value = '/myfiles/1.jpg';
            document.getElementById('method').value = 'GET';
            document.getElementById('requestBody').value = '';
            
            // æ¸…ç©ºæŸ¥è¯¢å‚æ•°
            const container = document.getElementById('queryParams');
            container.innerHTML = '';
            addEmptyParamRow();
            
            // æ¸…ç©ºè‡ªå®šä¹‰Headers
            const headersContainer = document.getElementById('customHeaders');
            headersContainer.innerHTML = '';
            const headerRow = document.createElement('div');
            headerRow.className = 'param-row';
            headerRow.innerHTML = `
                <input class="form-input header-key" type="text" placeholder="Header Name (å¦‚: x-tos-meta-example)">
                <input class="form-input header-value" type="text" placeholder="Header Value">
                <button type="button" class="btn btn-danger btn-sm" onclick="removeHeader(this)">åˆ é™¤</button>
            `;
            headersContainer.appendChild(headerRow);
            
            // æ—¶é—´æˆ³ä½¿ç”¨å½“å‰æ—¶é—´
            document.getElementById('timestampType').value = 'current';
            toggleTimestampInput();
            
            // éšè—ä¹‹å‰çš„ç»“æœ
            document.getElementById('results-panel').style.display = 'none';
            document.getElementById('flowchart-section').style.display = 'none';
            document.getElementById('code-examples-section').style.display = 'none';
            
            // æ˜¾ç¤ºå‹å¥½æç¤º
            showNotification('å·²è‡ªåŠ¨å¡«å…… GetObject æ¼”ç¤ºæ•°æ®ï¼Œå¯ä»¥åŸºäºè¯¥æ¨¡æ‹Ÿå¯†é’¥ï¼Œç‚¹å‡»æœ€ä¸‹æ–¹ [è®¡ç®—ç­¾å]ï¼ŒæŸ¥çœ‹ç­¾åè¿‡ç¨‹');
        }

        // ç­‰å¾…é¡µé¢åŠ è½½å®Œæˆååˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', function() {
            // ç¡®ä¿ Mermaid æ­£ç¡®åˆå§‹åŒ–
            if (typeof mermaid !== 'undefined') {
                mermaid.initialize({
                    startOnLoad: false,
                    theme: 'default',
                    flowchart: {
                        useMaxWidth: true,
                        htmlLabels: true,
                        curve: 'cardinal'
                    }
                });
            }
            
            // åˆå§‹åŒ–tabåŠŸèƒ½
            initializeTabs();
        });

        // åˆå§‹åŒ–tabåŠŸèƒ½
        function initializeTabs() {
            // ç¡®ä¿é»˜è®¤é€‰ä¸­Python tab
            switchTab('python');
            
            // ä¸ºæ‰€æœ‰tabæŒ‰é’®æ·»åŠ é”®ç›˜æ”¯æŒ
            const tabButtons = document.querySelectorAll('.tab-button');
            tabButtons.forEach((button, index) => {
                button.addEventListener('keydown', function(e) {
                    if (e.key === 'Enter' || e.key === ' ') {
                        e.preventDefault();
                        const tabName = button.getAttribute('data-tab');
                        switchTab(tabName);
                    }
                    // æ”¯æŒç®­å¤´é”®å¯¼èˆª
                    else if (e.key === 'ArrowLeft' || e.key === 'ArrowRight') {
                        e.preventDefault();
                        const direction = e.key === 'ArrowLeft' ? -1 : 1;
                        const nextIndex = (index + direction + tabButtons.length) % tabButtons.length;
                        tabButtons[nextIndex].focus();
                        const nextTabName = tabButtons[nextIndex].getAttribute('data-tab');
                        switchTab(nextTabName);
                    }
                });
            });
        }

        // å­˜å‚¨èŠ‚ç‚¹è¯¦ç»†ä¿¡æ¯
        let nodeDetails = {};
        let chartId = 0; // ç”¨äºç”Ÿæˆå”¯ä¸€ID

        // ç”Ÿæˆæµç¨‹å›¾
        function generateFlowchart(data) {
            // å®‰å…¨åœ°è½¬ä¹‰Mermaidå­—ç¬¦ä¸²ï¼Œé¿å…è¯­æ³•é”™è¯¯
            function safeMermaidText(text) {
                if (!text) return '';
                return text.toString()
                    .replace(/"/g, '&quot;')
                    .replace(/'/g, '&#39;')
                    .replace(/\\/g, '\\\\')
                    .replace(/\n/g, ' ')
                    .replace(/\r/g, ' ')
                    .substring(0, 50); // é™åˆ¶é•¿åº¦
            }
            
            const flowchartDefinition = `
flowchart TD
    %% è¾“å…¥å‚æ•°
    A1["Access Key<br/>${data.accessKey ? safeMermaidText(data.accessKey.substring(0, 8)) + '...' : 'N/A'}"]
    A2["Secret Key<br/>[å·²æä¾›]"]
    A3["Region<br/>${safeMermaidText(data.region)}"]
    A4["Service<br/>${safeMermaidText(data.service)}"]
    A5["HTTP Method<br/>${safeMermaidText(data.method)}"]
    A6["Host<br/>${safeMermaidText(data.host)}"]
    A7["Path<br/>${safeMermaidText(data.path)}"]
    A8["Request Body<br/>${data.requestBody ? (data.requestBody.length > 15 ? safeMermaidText(data.requestBody.substring(0, 15)) + '...' : safeMermaidText(data.requestBody)) : 'ç©º'}"]
    
    %% æ—¶é—´æˆ³å¤„ç†
    B1{"ç”Ÿæˆæ—¶é—´æˆ³"}
    B2["AMZ Date<br/>${safeMermaidText(data.amzDate)}"]
    B3["Date Stamp<br/>${safeMermaidText(data.dateStamp)}"]
    
    %% Payload Hash è®¡ç®—
    C1{"è®¡ç®— SHA256"}
    C2["Payload Hash<br/>${data.payloadHash ? safeMermaidText(data.payloadHash.substring(0, 16)) + '...' : 'N/A'}"]
    
    %% Query String å¤„ç†
    D1{"è§„èŒƒåŒ–æŸ¥è¯¢å‚æ•°"}
    D2["Canonical Query<br/>${safeMermaidText(data.canonicalQueryString || 'ç©º')}"]
    
    %% Headers å¤„ç†
    E1{"æ”¶é›† Headers"}
    E2["Host Header<br/>host:${safeMermaidText(data.host)}"]
    E3["Date Header<br/>x-tos-date:${safeMermaidText(data.amzDate)}"]
    E4["Content Header<br/>x-tos-content-sha256:${data.payloadHash ? safeMermaidText(data.payloadHash.substring(0, 12)) + '...' : 'N/A'}"]
    E5{"æ’åº Headers"}
    E6["Signed Headers<br/>${safeMermaidText(data.signedHeaders)}"]
    E7["Canonical Headers<br/>${data.canonicalHeaders ? (data.canonicalHeaders.split('\n').length - 1) + ' headers' : '0 headers'}"]
    
    %% Canonical Request æ„é€ 
    F1{"æ„é€  Canonical Request"}
    F2["Canonical Request<br/>[Method + URI + Query + Headers + Hash]"]
    F3{"SHA256 Hash"}
    F4["Request Hash<br/>${data.hashCR ? safeMermaidText(data.hashCR.substring(0, 16)) + '...' : 'N/A'}"]
    
    %% String To Sign æ„é€ 
    G1{"æ„é€  String To Sign"}
    G2["Credential Scope<br/>${safeMermaidText(data.credentialScope)}"]
    G3["String To Sign<br/>[Algorithm + Date + Scope + Hash]"]
    
    %% å¯†é’¥æ´¾ç”Ÿ
    H1{"HMAC-SHA256<br/>DateStamp, SecretKey"}
    H2["kDate<br/>[ä¸­é—´å¯†é’¥1]"]
    H3{"HMAC-SHA256<br/>Region, kDate"}
    H4["kRegion<br/>[ä¸­é—´å¯†é’¥2]"]
    H5{"HMAC-SHA256<br/>Service, kRegion"}
    H6["kService<br/>[ä¸­é—´å¯†é’¥3]"]
    H7{"HMAC-SHA256<br/>request, kService"}
    H8["kSigning<br/>${data.kSigning ? safeMermaidText(data.kSigning.substring(0, 16)) + '...' : 'N/A'}"]
    
    %% æœ€ç»ˆç­¾å
    I1{"HMAC-SHA256<br/>StringToSign, kSigning"}
    I2["Final Signature<br/>${data.signature ? safeMermaidText(data.signature.substring(0, 16)) + '...' : 'N/A'}"]
    
    %% Authorization Header
    J1{"æ„é€  Authorization"}
    J2["Authorization Header<br/>TOS4-HMAC-SHA256 Credential=..."]
    
    %% è¿æ¥å…³ç³»
    %% æ—¶é—´æˆ³æµ
    B1 --> B2
    B1 --> B3
    
    %% Payload Hash æµ
    A8 --> C1
    C1 --> C2
    
    %% Query æµ
    D1 --> D2
    
    %% Headers æµ
    A6 --> E2
    B2 --> E3
    C2 --> E4
    E1 --> E2
    E1 --> E3  
    E1 --> E4
    E2 --> E5
    E3 --> E5
    E4 --> E5
    E5 --> E6
    E5 --> E7
    
    %% Canonical Request æµ
    A5 --> F1
    A7 --> F1
    D2 --> F1
    E6 --> F1
    E7 --> F1
    C2 --> F1
    F1 --> F2
    F2 --> F3
    F3 --> F4
    
    %% String To Sign æµ
    B2 --> G1
    B3 --> G2
    A3 --> G2
    A4 --> G2
    G2 --> G1
    F4 --> G1
    G1 --> G3
    
    %% å¯†é’¥æ´¾ç”Ÿæµ
    A2 --> H1
    B3 --> H1
    H1 --> H2
    A3 --> H3
    H2 --> H3
    H3 --> H4
    A4 --> H5
    H4 --> H5
    H5 --> H6
    H6 --> H7
    H7 --> H8
    
    %% æœ€ç»ˆç­¾åæµ
    G3 --> I1
    H8 --> I1
    I1 --> I2
    
    %% Authorization æµ
    A1 --> J1
    G2 --> J1
    E6 --> J1
    I2 --> J1
    J1 --> J2
    
    %% æ ·å¼
    classDef dataNode fill:#e3f2fd,stroke:#2196f3,stroke-width:2px,color:#1565c0;
    classDef processNode fill:#fff3e0,stroke:#ff9800,stroke-width:2px,color:#e65100;
    classDef resultNode fill:#e8f5e8,stroke:#4caf50,stroke-width:2px,color:#2e7d32;
    
    class A1,A2,A3,A4,A5,A6,A7,A8,B2,B3,C2,D2,E2,E3,E4,E6,E7,F2,F4,G2,G3,H2,H4,H6,H8,I2,J2 dataNode;
    class B1,C1,D1,E1,E5,F1,F3,G1,H1,H3,H5,H7,I1,J1 processNode;
            `;
            
            // å­˜å‚¨èŠ‚ç‚¹è¯¦ç»†ä¿¡æ¯
            nodeDetails = {
                // è¾“å…¥å‚æ•°èŠ‚ç‚¹
                A1: {
                    title: 'Access Key',
                    content: `å®Œæ•´çš„Access Key:\n${data.accessKey || '[æœªæä¾›]'}`
                },
                A2: {
                    title: 'Secret Key',
                    content: `Secret Key: [å‡ºäºå®‰å…¨è€ƒè™‘ä¸æ˜¾ç¤ºå®Œæ•´å†…å®¹]\né•¿åº¦: ${data.secretKey ? data.secretKey.length + ' å­—ç¬¦' : 'æœªæä¾›'}`
                },
                A3: {
                    title: 'Region å‚æ•°',
                    content: `Region: ${data.region}\nç”¨é€”: æŒ‡å®šæœåŠ¡çš„åœ°ç†åŒºåŸŸ`
                },
                A4: {
                    title: 'Service å‚æ•°', 
                    content: `Service: ${data.service}\nç”¨é€”: æŒ‡å®šè¦è®¿é—®çš„æœåŠ¡ç±»å‹`
                },
                A5: {
                    title: 'HTTP Method',
                    content: `HTTP Method: ${data.method}\næ”¯æŒçš„æ–¹æ³•: GET, POST, PUT, DELETE, HEAD`
                },
                A6: {
                    title: 'Host å‚æ•°',
                    content: `Host: ${data.host}\nç”¨é€”: ç›®æ ‡æœåŠ¡å™¨åœ°å€`
                },
                A7: {
                    title: 'Path å‚æ•°',
                    content: `Path: ${data.path}\nç”¨é€”: è¯·æ±‚çš„èµ„æºè·¯å¾„`
                },
                A8: {
                    title: 'Request Body',
                    content: `Request Body:\n${data.requestBody || '(ç©ºè¯·æ±‚ä½“)'}\né•¿åº¦: ${(data.requestBody || '').length} å­—èŠ‚`
                },
                
                // æ—¶é—´æˆ³å¤„ç†èŠ‚ç‚¹
                B1: {
                    title: 'æ—¶é—´æˆ³ç”Ÿæˆè¿‡ç¨‹',
                    content: `æ—¶é—´æˆ³ç±»å‹: ${data.timestampType}\nåŸå§‹æ—¶é—´: ${data.originalTime}\nå¤„ç†è§„åˆ™: å°†ISOæ—¶é—´è½¬æ¢ä¸ºYYYYMMDDTHHMMSSZæ ¼å¼`
                },
                B2: {
                    title: 'AMZ Date æ—¶é—´æˆ³',
                    content: `AMZ Date: ${data.amzDate}\næ ¼å¼: YYYYMMDDTHHMMSSZ\nç”¨é€”: ç”¨äºHeaderså’ŒStringToSign`
                },
                B3: {
                    title: 'Date Stamp',
                    content: `Date Stamp: ${data.dateStamp}\næ ¼å¼: YYYYMMDD\nç”¨é€”: ç”¨äºå¯†é’¥æ´¾ç”Ÿå’Œå‡­è¯èŒƒå›´`
                },
                
                // Payload Hash èŠ‚ç‚¹
                C1: {
                    title: 'SHA256 è®¡ç®—è¿‡ç¨‹',
                    content: `è¾“å…¥: Request Body\nç®—æ³•: SHA256\nè¾“å‡º: 64å­—ç¬¦åå…­è¿›åˆ¶å­—ç¬¦ä¸²\n\nå¦‚æœBodyä¸ºç©ºåˆ™è®¡ç®—ç©ºå­—ç¬¦ä¸²çš„SHA256\nå¦‚æœæ˜¯PUTæ“ä½œä¸”æ— æ³•è·å–å†…å®¹åˆ™ä½¿ç”¨'UNSIGNED-PAYLOAD'`
                },
                C2: {
                    title: 'Payload Hash ç»“æœ',
                    content: `Payload Hash: ${data.payloadHash}\né•¿åº¦: ${data.payloadHash.length} å­—ç¬¦\nç®—æ³•: SHA256\nç”¨é€”: ç”¨äºHeaderså’ŒCanonicalRequest`
                },
                
                // Query Parameters èŠ‚ç‚¹
                D1: {
                    title: 'Queryå‚æ•°è§„èŒƒåŒ–è¿‡ç¨‹',
                    content: `å¤„ç†æ­¥éª¤:\n1. æ”¶é›†æ‰€æœ‰æŸ¥è¯¢å‚æ•°\n2. æŒ‰å‚æ•°åæ’åº\n3. å¯¹å‚æ•°åå’Œå€¼è¿›è¡ŒURLç¼–ç \n4. æ‹¼æ¥ä¸ºkey=valueæ ¼å¼`
                },
                D2: {
                    title: 'Canonical Query String',
                    content: `Canonical Query String: "${data.canonicalQueryString}"\nå‚æ•°æ•°é‡: ${data.paramCount}\nè¯¦æƒ…: ${data.paramDetails}`
                },
                
                // Headers å¤„ç†èŠ‚ç‚¹
                E1: {
                    title: 'Headers æ”¶é›†è¿‡ç¨‹',
                    content: `æ”¶é›†çš„Headersç±»å‹:\n1. host (å¿…éœ€)\n2. x-tos-date (å¿…éœ€) \n3. x-tos-content-sha256 (å¿…éœ€)\n4. x-tos-meta-* (å¯é€‰)\n5. å…¶ä»–éœ€è¦ç­¾åçš„headers`
                },
                E2: {
                    title: 'Host Header',
                    content: `Headerå: host\nHeaderå€¼: ${data.host}\nç”¨é€”: æŒ‡å®šç›®æ ‡æœåŠ¡å™¨\nå¿…éœ€: æ˜¯`
                },
                E3: {
                    title: 'Date Header',
                    content: `Headerå: x-tos-date\nHeaderå€¼: ${data.amzDate}\nç”¨é€”: è¯·æ±‚æ—¶é—´æˆ³\nå¿…éœ€: æ˜¯`
                },
                E4: {
                    title: 'Content SHA256 Header',
                    content: `Headerå: x-tos-content-sha256\nHeaderå€¼: ${data.payloadHash}\nç”¨é€”: è¯·æ±‚ä½“å†…å®¹å“ˆå¸Œ\nå¿…éœ€: æ˜¯`
                },
                E5: {
                    title: 'Headers æ’åºè¿‡ç¨‹',
                    content: `æ’åºè§„åˆ™: æŒ‰Headeråç§°å­—æ¯é¡ºåºæ’åº\næ’åºåé¡ºåº: ${data.signedHeaders.split(';').join(', ')}`
                },
                E6: {
                    title: 'Signed Headers',
                    content: `Signed Headers: ${data.signedHeaders}\næ ¼å¼: ç”¨åˆ†å·åˆ†éš”çš„å°å†™headerååˆ—è¡¨\nç”¨é€”: å‘ŠçŸ¥å“ªäº›headerså‚ä¸äº†ç­¾å`
                },
                E7: {
                    title: 'Canonical Headers',
                    content: `Canonical Headers:\n${data.canonicalHeaders}\næ ¼å¼: æ¯è¡Œä¸€ä¸ªheaderï¼Œæ ¼å¼ä¸º"name:value\\n"\nç”¨é€”: æ„é€ CanonicalRequestçš„ä¸€éƒ¨åˆ†`
                },
                
                // Canonical Request èŠ‚ç‚¹
                F1: {
                    title: 'Canonical Request æ„é€ è¿‡ç¨‹',
                    content: `æ„é€ è§„åˆ™:\nMethod + "\\n" +\nURI + "\\n" +\nQueryString + "\\n" +\nCanonicalHeaders + "\\n" +\nSignedHeaders + "\\n" +\nPayloadHash`
                },
                F2: {
                    title: 'Canonical Request',
                    content: `Canonical Request:\n${data.canonicalRequest}\n\né•¿åº¦: ${data.canonicalRequest.length} å­—ç¬¦`
                },
                F3: {
                    title: 'Canonical Request SHA256',
                    content: `ç®—æ³•: SHA256\nè¾“å…¥: Canonical Request å­—ç¬¦ä¸²\nè¾“å‡º: 64å­—ç¬¦åå…­è¿›åˆ¶å­—ç¬¦ä¸²`
                },
                F4: {
                    title: 'Request Hash',
                    content: `Request Hash: ${data.hashCR}\né•¿åº¦: ${data.hashCR.length} å­—ç¬¦\nç®—æ³•: SHA256\nç”¨é€”: æ„é€ StringToSign`
                },
                
                // String To Sign èŠ‚ç‚¹
                G1: {
                    title: 'String To Sign æ„é€ è¿‡ç¨‹',
                    content: `æ„é€ è§„åˆ™:\nAlgorithm + "\\n" +\nTimestamp + "\\n" +\nCredentialScope + "\\n" +\nHashedCanonicalRequest`
                },
                G2: {
                    title: 'Credential Scope',
                    content: `Credential Scope: ${data.credentialScope}\næ ¼å¼: YYYYMMDD/region/service/request\nç»„æˆ: DateStamp/${data.region}/${data.service}/request`
                },
                G3: {
                    title: 'String To Sign',
                    content: `String To Sign:\n${data.stringToSign}\n\né•¿åº¦: ${data.stringToSign.length} å­—ç¬¦`
                },
                
                // å¯†é’¥æ´¾ç”ŸèŠ‚ç‚¹
                H1: {
                    title: 'kDate è®¡ç®—è¿‡ç¨‹',
                    content: `ç®—æ³•: HMAC-SHA256\nå¯†é’¥: Secret Key\næ¶ˆæ¯: "${data.dateStamp}"\nè¾“å‡º: kDate (äºŒè¿›åˆ¶å¯†é’¥)`
                },
                H2: {
                    title: 'kDate ä¸­é—´å¯†é’¥',
                    content: `kDate: [ä¸­é—´å¯†é’¥1]\nç®—æ³•: HMAC-SHA256\nè¾“å…¥å¯†é’¥: Secret Key\næ¶ˆæ¯: ${data.dateStamp}\nç”¨é€”: è®¡ç®—kRegionçš„å¯†é’¥`
                },
                H3: {
                    title: 'kRegion è®¡ç®—è¿‡ç¨‹',
                    content: `ç®—æ³•: HMAC-SHA256\nå¯†é’¥: kDate\næ¶ˆæ¯: "${data.region}"\nè¾“å‡º: kRegion (äºŒè¿›åˆ¶å¯†é’¥)`
                },
                H4: {
                    title: 'kRegion ä¸­é—´å¯†é’¥',
                    content: `kRegion: [ä¸­é—´å¯†é’¥2]\nç®—æ³•: HMAC-SHA256\nè¾“å…¥å¯†é’¥: kDate\næ¶ˆæ¯: ${data.region}\nç”¨é€”: è®¡ç®—kServiceçš„å¯†é’¥`
                },
                H5: {
                    title: 'kService è®¡ç®—è¿‡ç¨‹',
                    content: `ç®—æ³•: HMAC-SHA256\nå¯†é’¥: kRegion\næ¶ˆæ¯: "${data.service}"\nè¾“å‡º: kService (äºŒè¿›åˆ¶å¯†é’¥)`
                },
                H6: {
                    title: 'kService ä¸­é—´å¯†é’¥',
                    content: `kService: [ä¸­é—´å¯†é’¥3]\nç®—æ³•: HMAC-SHA256\nè¾“å…¥å¯†é’¥: kRegion\næ¶ˆæ¯: ${data.service}\nç”¨é€”: è®¡ç®—kSigningçš„å¯†é’¥`
                },
                H7: {
                    title: 'kSigning è®¡ç®—è¿‡ç¨‹',
                    content: `ç®—æ³•: HMAC-SHA256\nå¯†é’¥: kService\næ¶ˆæ¯: "request"\nè¾“å‡º: kSigning (æœ€ç»ˆç­¾åå¯†é’¥)`
                },
                H8: {
                    title: 'kSigning æœ€ç»ˆå¯†é’¥',
                    content: `kSigning: ${data.kSigning}\né•¿åº¦: 64å­—ç¬¦ (32å­—èŠ‚åå…­è¿›åˆ¶)\nç®—æ³•: HMAC-SHA256\nè¾“å…¥å¯†é’¥: kService\næ¶ˆæ¯: "request"\nç”¨é€”: è®¡ç®—æœ€ç»ˆç­¾å`
                },
                
                // æœ€ç»ˆç­¾åèŠ‚ç‚¹
                I1: {
                    title: 'æœ€ç»ˆç­¾åè®¡ç®—è¿‡ç¨‹',
                    content: `ç®—æ³•: HMAC-SHA256\nå¯†é’¥: kSigning\næ¶ˆæ¯: String To Sign\nè¾“å‡º: æœ€ç»ˆç­¾å (64å­—ç¬¦åå…­è¿›åˆ¶)`
                },
                I2: {
                    title: 'æœ€ç»ˆç­¾åç»“æœ',
                    content: `Final Signature: ${data.signature}\né•¿åº¦: ${data.signature.length} å­—ç¬¦\nç®—æ³•: HMAC-SHA256\nè¾“å…¥å¯†é’¥: kSigning\næ¶ˆæ¯: String To Sign\nç”¨é€”: æ„é€ Authorization Header`
                },
                
                // Authorization Header èŠ‚ç‚¹
                J1: {
                    title: 'Authorization æ„é€ è¿‡ç¨‹',
                    content: `æ ¼å¼: Algorithm Credential=AccessKey/CredentialScope, SignedHeaders=headers, Signature=signature\n\nç»„æˆéƒ¨åˆ†:\n- Algorithm: ${data.algorithm}\n- Credential: ${data.accessKey}/${data.credentialScope}\n- SignedHeaders: ${data.signedHeaders}\n- Signature: ${data.signature}`
                },
                J2: {
                    title: 'Authorization Header',
                    content: `Authorization Header:\n${data.authHeader}\n\né•¿åº¦: ${data.authHeader.length} å­—ç¬¦\nç”¨é€”: HTTPè¯·æ±‚çš„Authorizationå¤´éƒ¨`
                }
            };
            
            return flowchartDefinition;
        }

        // æ˜¾ç¤ºèŠ‚ç‚¹è¯¦ç»†ä¿¡æ¯
        function showDetails(nodeId) {
            const details = nodeDetails[nodeId];
            if (details) {
                document.getElementById('node-content').innerHTML = 
                    `<h4>${details.title}</h4><pre>${details.content}</pre>`;
                document.getElementById('node-details').style.display = 'block';
            }
        }

        // æ¸²æŸ“æµç¨‹å›¾
        async function renderFlowchart(data) {
            try {
                if (typeof mermaid === 'undefined') {
                    throw new Error('Mermaid library not loaded');
                }
                
                chartId++;
                const currentChartId = `mermaid-chart-${chartId}`;
                const flowchartDef = generateFlowchart(data);
                const element = document.getElementById('signature-flowchart');
                
                // æ¸…ç©ºä¹‹å‰çš„å†…å®¹
                element.innerHTML = `<div id="${currentChartId}" class="mermaid">${flowchartDef}</div>`;
                
                // ä½¿ç”¨ Mermaid æ¸²æŸ“
                const { svg } = await mermaid.render(currentChartId + '-svg', flowchartDef);
                element.innerHTML = svg;
                
                // æ·»åŠ ç‚¹å‡»äº‹ä»¶ç›‘å¬å™¨ - å¢åŠ å»¶è¿Ÿç¡®ä¿DOMå®Œå…¨åŠ è½½
                setTimeout(() => {
                    addClickListeners();
                }, 500);
            } catch (error) {
                console.error('Mermaid rendering error:', error);
                // é™çº§å¤„ç†ï¼šæ˜¾ç¤ºæ–‡æœ¬ç‰ˆæœ¬
                const element = document.getElementById('signature-flowchart');
                element.innerHTML = `
                    <div style="text-align: left; background: var(--titanium-background); padding: 20px; border-radius: 4px;">
                        <p><strong>æµç¨‹å›¾æ¸²æŸ“å¤±è´¥ï¼Œæ˜¾ç¤ºæ–‡æœ¬ç‰ˆæœ¬ï¼š</strong></p>
                        <div style="font-family: -apple-system, BlinkMacSystemFont, 'SF Mono', Monaco, monospace; white-space: pre-line; color: var(--titanium-text);">
                            1. ğŸ”§ åŸºç¡€å‚æ•°: Method=${data.method}, Host=${data.host}, Path=${data.path}
                            2. â° æ—¶é—´æˆ³å¤„ç†: ${data.amzDate}
                            3. ğŸ“ Payload Hash: ${data.payloadHash}
                            4. ğŸ” Query Parameters: ${data.canonicalQueryString}
                            5. ğŸ“‹ Headers å¤„ç†: ${data.signedHeaders}
                            6. ğŸ“„ Canonical Request: å·²æ„é€ 
                            7. ğŸ” String To Sign: å·²æ„é€ 
                            8. ğŸ”‘ å¯†é’¥æ´¾ç”Ÿ: kSigning=${data.kSigning}
                            9. âœ… æœ€ç»ˆç­¾å: ${data.signature}
                            10. ğŸ“¤ Authorization Header: å·²ç”Ÿæˆ
                        </div>
                        <p style="margin-top: 15px;"><small>ç‚¹å‡»å³ä¾§è¯¦ç»†è¾“å‡ºæŸ¥çœ‹å®Œæ•´ä¿¡æ¯</small></p>
                    </div>
                `;
            }
        }

        // æ·»åŠ ç‚¹å‡»äº‹ä»¶ç›‘å¬å™¨
        function addClickListeners() {
            console.log('æ·»åŠ ç‚¹å‡»äº‹ä»¶ç›‘å¬å™¨');
            const container = document.getElementById('signature-flowchart');
            
            if (!container) {
                console.error('æœªæ‰¾åˆ°æµç¨‹å›¾å®¹å™¨');
                return;
            }
            
            // ç§»é™¤ä¹‹å‰çš„äº‹ä»¶ç›‘å¬å™¨ï¼Œç¡®ä¿ä¸é‡å¤ç»‘å®š
            const existingHandler = container._clickHandler;
            if (existingHandler) {
                container.removeEventListener('click', existingHandler);
                console.log('ç§»é™¤äº†ä¹‹å‰çš„äº‹ä»¶ç›‘å¬å™¨');
            }
            
            // åˆ›å»ºæ–°çš„å¤„ç†å‡½æ•°å¹¶ä¿å­˜å¼•ç”¨
            const newHandler = (event) => handleNodeClick(event);
            container._clickHandler = newHandler;
            
            // æ·»åŠ æ–°çš„äº‹ä»¶ç›‘å¬å™¨
            container.addEventListener('click', newHandler);
            
            // æŸ¥æ‰¾SVGå†…çš„æ‰€æœ‰èŠ‚ç‚¹å¹¶æ·»åŠ è°ƒè¯•ä¿¡æ¯
            setTimeout(() => {
                const svgNodes = container.querySelectorAll('g.node, g.flowchart-node, rect, text, g');
                console.log(`æ‰¾åˆ° ${svgNodes.length} ä¸ªå¯èƒ½çš„èŠ‚ç‚¹å…ƒç´ `);
                
                // ä¸ºæ¯ä¸ªèŠ‚ç‚¹æ·»åŠ è°ƒè¯•æ ·å¼
                svgNodes.forEach((node, index) => {
                    if (node.textContent && node.textContent.trim()) {
                        node.style.cursor = 'pointer';
                        console.log(`èŠ‚ç‚¹ ${index}:`, node.tagName, node.textContent.substring(0, 50));
                    }
                });
            }, 100);
            
            console.log('æ–°çš„äº‹ä»¶ç›‘å¬å™¨å·²æ·»åŠ åˆ°å®¹å™¨');
        }
        
        function handleNodeClick(event) {
            console.log('ç‚¹å‡»äº‹ä»¶è§¦å‘', event.target);
            console.log('ç‚¹å‡»ä½ç½®:', event.clientX, event.clientY);
            
            // æŸ¥æ‰¾æœ€è¿‘çš„èŠ‚ç‚¹å…ƒç´ 
            let targetNode = event.target;
            let nodeId = null;
            
            // è·å–ç›®æ ‡èŠ‚ç‚¹åŠå…¶ç›¸å…³èŠ‚ç‚¹çš„æ–‡æœ¬å†…å®¹ï¼Œæ”¯æŒå¤šå±‚çº§æŸ¥æ‰¾
            let nodeText = targetNode.textContent || '';
            let parentText = '';
            let grandparentText = '';
            
            // æŸ¥æ‰¾çˆ¶èŠ‚ç‚¹å’Œç¥–çˆ¶èŠ‚ç‚¹æ–‡æœ¬ï¼ˆé™åˆ¶æŸ¥æ‰¾èŒƒå›´ï¼‰
            let parent = targetNode.parentElement;
            if (parent && parent.tagName !== 'svg') {
                parentText = parent.textContent || '';
                
                // å¯¹äº polygon ç­‰å›¾å½¢å…ƒç´ ï¼Œéœ€è¦æŸ¥æ‰¾æ›´ä¸Šå±‚çš„æ–‡æœ¬
                let grandparent = parent.parentElement;
                if (grandparent && grandparent.tagName !== 'svg') {
                    grandparentText = grandparent.textContent || '';
                }
            }
            
            // æ™ºèƒ½é€‰æ‹©ç”¨äºåŒ¹é…çš„æ–‡æœ¬ï¼Œä¼˜å…ˆé€‰æ‹©æœ€åˆé€‚é•¿åº¦çš„æ–‡æœ¬
            let textToMatch = '';
            let candidateTexts = [nodeText, parentText, grandparentText].filter(text => text.length > 0);
            
            // é€‰æ‹©é•¿åº¦é€‚ä¸­ä¸”åŒ…å«æœ‰æ•ˆä¿¡æ¯çš„æ–‡æœ¬
            for (let candidate of candidateTexts) {
                if (candidate.length > 0 && candidate.length <= 200) {
                    // å¦‚æœåŒ…å«å…³é”®è¯ï¼Œä¼˜å…ˆä½¿ç”¨
                    if (candidate.includes('ç”Ÿæˆæ—¶é—´æˆ³') || candidate.includes('è®¡ç®— SHA256') || 
                        candidate.includes('è§„èŒƒåŒ–æŸ¥è¯¢å‚æ•°') || candidate.includes('æ”¶é›† Headers') ||
                        candidate.includes('æ„é€ ') || candidate.includes('HMAC-SHA256') ||
                        candidate.includes('Access Key') || candidate.includes('Secret Key') ||
                        candidate.includes('Region') || candidate.includes('Service') ||
                        candidate.includes('HTTP Method') || candidate.includes('Host') ||
                        candidate.includes('Path') || candidate.includes('Request Body') ||
                        candidate.includes('AMZ Date') || candidate.includes('Date Stamp') ||
                        candidate.includes('Payload Hash') || candidate.includes('Canonical') ||
                        candidate.includes('String To Sign') || candidate.includes('Authorization') ||
                        candidate.includes('Final Signature') || candidate.includes('kDate') ||
                        candidate.includes('kRegion') || candidate.includes('kService') ||
                        candidate.includes('kSigning')) {
                        textToMatch = candidate;
                        break;
                    }
                }
            }
            
            // å¦‚æœæ²¡æœ‰æ‰¾åˆ°åˆé€‚çš„æ–‡æœ¬ï¼Œä½¿ç”¨æœ€çŸ­çš„éç©ºæ–‡æœ¬
            if (!textToMatch && candidateTexts.length > 0) {
                textToMatch = candidateTexts.reduce((shortest, current) => 
                    current.length < shortest.length ? current : shortest
                );
            }
            
            // å¦‚æœæ–‡æœ¬å¤ªé•¿ï¼Œæˆªå–å‰é¢éƒ¨åˆ†
            if (textToMatch.length > 100) {
                textToMatch = textToMatch.substring(0, 100);
            }
            
            console.log('ç”¨äºåŒ¹é…çš„æ–‡æœ¬å†…å®¹:', textToMatch);
            console.log('ç›®æ ‡å…ƒç´ :', targetNode.tagName, targetNode.className);
            console.log('çˆ¶å…ƒç´ :', parent ? parent.tagName : 'none', parent ? parent.className : 'none');
            
            // æ›´ç²¾ç¡®çš„æ–‡æœ¬åŒ¹é… - ä½¿ç”¨æ›´ä¸¥æ ¼çš„åŒ¹é…æ¡ä»¶
            // è¾“å…¥å‚æ•°èŠ‚ç‚¹
            if (textToMatch === 'Access Key' || (textToMatch.includes('Access Key') && textToMatch.length < 50)) {
                nodeId = 'A1';
            } else if (textToMatch === 'Secret Key' || (textToMatch.includes('Secret Key') && textToMatch.includes('[å·²æä¾›]'))) {
                nodeId = 'A2';
            } else if ((textToMatch.includes('Region') && !textToMatch.includes('kRegion')) && textToMatch.length < 50) {
                nodeId = 'A3';
            } else if ((textToMatch.includes('Service') && !textToMatch.includes('kService')) && textToMatch.length < 50) {
                nodeId = 'A4';
            } else if (textToMatch.includes('HTTP Method') && textToMatch.length < 50) {
                nodeId = 'A5';
            } else if ((textToMatch.includes('Host') && !textToMatch.includes('Header')) && textToMatch.length < 50) {
                nodeId = 'A6';
            } else if (textToMatch.includes('Path') && textToMatch.length < 50) {
                nodeId = 'A7';
            } else if (textToMatch.includes('Request Body') && textToMatch.length < 50) {
                nodeId = 'A8';
            }
            
            // æ—¶é—´æˆ³èŠ‚ç‚¹
            else if (textToMatch.includes('ç”Ÿæˆæ—¶é—´æˆ³') && textToMatch.length < 50) {
                nodeId = 'B1';
            } else if (textToMatch.includes('AMZ Date') && textToMatch.length < 50) {
                nodeId = 'B2';
            } else if (textToMatch.includes('Date Stamp') && textToMatch.length < 50) {
                nodeId = 'B3';
            }
            
            // Payload Hash èŠ‚ç‚¹
            else if (textToMatch.includes('è®¡ç®— SHA256') && textToMatch.length < 50) {
                nodeId = 'C1';
            } else if (textToMatch.includes('Payload Hash') && textToMatch.length < 50) {
                nodeId = 'C2';
            }
            
            // Query èŠ‚ç‚¹
            else if (textToMatch.includes('è§„èŒƒåŒ–æŸ¥è¯¢å‚æ•°') && textToMatch.length < 50) {
                nodeId = 'D1';
            } else if (textToMatch.includes('Canonical Query') && textToMatch.length < 50) {
                nodeId = 'D2';
            }
            
            // Headers èŠ‚ç‚¹
            else if (textToMatch.includes('æ”¶é›† Headers') && textToMatch.length < 50) {
                nodeId = 'E1';
            } else if (textToMatch.includes('Host Header') && textToMatch.length < 80) {
                nodeId = 'E2';
            } else if (textToMatch.includes('Date Header') && textToMatch.length < 80) {
                nodeId = 'E3';
            } else if (textToMatch.includes('Content Header') && textToMatch.length < 80) {
                nodeId = 'E4';
            } else if (textToMatch.includes('æ’åº Headers') && textToMatch.length < 50) {
                nodeId = 'E5';
            } else if (textToMatch.includes('Signed Headers') && textToMatch.length < 100) {
                nodeId = 'E6';
            } else if (textToMatch.includes('Canonical Headers') && textToMatch.includes('headers') && textToMatch.length < 100) {
                nodeId = 'E7';
            }
            
            // Canonical Request èŠ‚ç‚¹
            else if (textToMatch.includes('æ„é€  Canonical Request') && textToMatch.length < 50) {
                nodeId = 'F1';
            } else if (textToMatch.includes('Canonical Request') && textToMatch.includes('[Method') && textToMatch.length < 100) {
                nodeId = 'F2';
            } else if (textToMatch.includes('SHA256 Hash') && textToMatch.length < 50) {
                nodeId = 'F3';
            } else if (textToMatch.includes('Request Hash') && textToMatch.length < 50) {
                nodeId = 'F4';
            }
            
            // String To Sign èŠ‚ç‚¹
            else if (textToMatch.includes('æ„é€  String To Sign') && textToMatch.length < 50) {
                nodeId = 'G1';
            } else if (textToMatch.includes('Credential Scope') && textToMatch.length < 100) {
                nodeId = 'G2';
            } else if (textToMatch.includes('String To Sign') && textToMatch.includes('[Algorithm') && textToMatch.length < 100) {
                nodeId = 'G3';
            }
            
            // å¯†é’¥æ´¾ç”ŸèŠ‚ç‚¹
            else if (textToMatch.includes('HMAC-SHA256') && textToMatch.includes('DateStamp') && textToMatch.length < 100) {
                nodeId = 'H1';
            } else if (textToMatch.includes('kDate') && textToMatch.includes('[ä¸­é—´å¯†é’¥1]') && textToMatch.length < 50) {
                nodeId = 'H2';
            } else if (textToMatch.includes('HMAC-SHA256') && textToMatch.includes('Region') && !textToMatch.includes('DateStamp') && textToMatch.length < 100) {
                nodeId = 'H3';
            } else if (textToMatch.includes('kRegion') && textToMatch.includes('[ä¸­é—´å¯†é’¥2]') && textToMatch.length < 50) {
                nodeId = 'H4';
            } else if (textToMatch.includes('HMAC-SHA256') && textToMatch.includes('Service') && !textToMatch.includes('Region') && textToMatch.length < 100) {
                nodeId = 'H5';
            } else if (textToMatch.includes('kService') && textToMatch.includes('[ä¸­é—´å¯†é’¥3]') && textToMatch.length < 50) {
                nodeId = 'H6';
            } else if (textToMatch.includes("'request'") && textToMatch.length < 100) {
                nodeId = 'H7';
            } else if (textToMatch.includes('kSigning') && !textToMatch.includes('StringToSign') && textToMatch.length < 50) {
                nodeId = 'H8';
            }
            
            // æœ€ç»ˆç­¾åèŠ‚ç‚¹
            else if (textToMatch.includes('HMAC-SHA256') && textToMatch.includes('StringToSign') && textToMatch.length < 100) {
                nodeId = 'I1';
            } else if (textToMatch.includes('Final Signature') && textToMatch.length < 50) {
                nodeId = 'I2';
            }
            
            // Authorization èŠ‚ç‚¹
            else if (textToMatch.includes('æ„é€  Authorization') && textToMatch.length < 50) {
                nodeId = 'J1';
            } else if (textToMatch.includes('Authorization Header') && textToMatch.includes('TOS4') && textToMatch.length < 100) {
                nodeId = 'J2';
            }
            
            if (nodeId) {
                console.log('åŒ¹é…åˆ°èŠ‚ç‚¹ID:', nodeId);
                showDetails(nodeId);
                
                // æ·»åŠ è§†è§‰åé¦ˆ
                const nodeDetailsDiv = document.getElementById('node-details');
                if (nodeDetailsDiv) {
                    nodeDetailsDiv.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
                }
            } else {
                console.log('æœªæ‰¾åˆ°åŒ¹é…çš„èŠ‚ç‚¹');
                console.log('èŠ‚ç‚¹æ–‡æœ¬:', nodeText);
                console.log('çˆ¶èŠ‚ç‚¹æ–‡æœ¬:', parentText);
                console.log('ç¥–çˆ¶èŠ‚ç‚¹æ–‡æœ¬:', grandparentText);
                console.log('ç”¨äºåŒ¹é…çš„æ–‡æœ¬:', textToMatch);
                
                // æ˜¾ç¤ºç”¨æˆ·å‹å¥½çš„æç¤ºä¿¡æ¯ï¼Œä¸æ˜¾ç¤ºæŠ€æœ¯è°ƒè¯•ç»†èŠ‚
                document.getElementById('node-content').innerHTML = 
                    `<h4>èŠ‚ç‚¹ä¿¡æ¯</h4><div style="padding: 10px; background: #f8f9fa; border-radius: 4px; color: #6c757d;">
                        <p>ğŸ‘† è¯·ç‚¹å‡»æµç¨‹å›¾ä¸­çš„å…·ä½“èŠ‚ç‚¹ï¼ˆçŸ©å½¢æˆ–è±å½¢æ¡†ï¼‰æŸ¥çœ‹è¯¦ç»†ä¿¡æ¯</p>
                        <p>ğŸ’¡ æç¤ºï¼š</p>
                        <ul style="margin: 8px 0; padding-left: 20px;">
                            <li>çŸ©å½¢æ¡†ä»£è¡¨æ•°æ®æˆ–ç»“æœ</li>
                            <li>è±å½¢æ¡†ä»£è¡¨å¤„ç†è¿‡ç¨‹</li>
                            <li>ç‚¹å‡»ä¸åŒçš„èŠ‚ç‚¹å¯ä»¥æŸ¥çœ‹è¯¥æ­¥éª¤çš„è¯¦ç»†è¯´æ˜</li>
                        </ul>
                    </div>`;
                document.getElementById('node-details').style.display = 'block';
            }
            
            // ä¸è¦é˜»æ­¢äº‹ä»¶ä¼ æ’­ï¼Œè®©ç‚¹å‡»äº‹ä»¶èƒ½å¤Ÿç»§ç»­å·¥ä½œ
            // event.preventDefault();
            // event.stopPropagation();
        }
        function addParam() {
            const container = document.getElementById('queryParams');
            const paramRow = document.createElement('div');
            paramRow.className = 'param-row';
            paramRow.innerHTML = `
                <input class="form-input param-key" type="text" placeholder="å‚æ•°å">
                <input class="form-input param-value" type="text" placeholder="å‚æ•°å€¼">
                <button type="button" class="btn btn-danger btn-sm" onclick="removeParam(this)">åˆ é™¤</button>
            `;
            container.appendChild(paramRow);
        }

        function removeParam(button) {
            button.parentElement.remove();
        }

        function addHeader() {
            const container = document.getElementById('customHeaders');
            const headerRow = document.createElement('div');
            headerRow.className = 'param-row';
            headerRow.innerHTML = `
                <input class="form-input header-key" type="text" placeholder="Header Name (å¦‚: x-tos-meta-example)">
                <input class="form-input header-value" type="text" placeholder="Header Value">
                <button type="button" class="btn btn-danger btn-sm" onclick="removeHeader(this)">åˆ é™¤</button>
            `;
            container.appendChild(headerRow);
        }

        function removeHeader(button) {
            button.parentElement.remove();
        }

        function showNotification(message) {
            const notification = document.getElementById('notification');
            notification.textContent = message;
            notification.style.display = 'block';
        }

        function hideNotification() {
            const notification = document.getElementById('notification');
            notification.style.display = 'none';
        }

        function processHost(hostInput) {
            let originalHost = hostInput.trim();
            let processedHost = originalHost;
            let changes = [];

            // ç§»é™¤ http:// æˆ– https:// å‰ç¼€
            if (processedHost.startsWith('http://')) {
                processedHost = processedHost.substring(7);
                changes.push('ç§»é™¤äº† http:// å‰ç¼€');
            } else if (processedHost.startsWith('https://')) {
                processedHost = processedHost.substring(8);
                changes.push('ç§»é™¤äº† https:// å‰ç¼€');
            }

            // ç§»é™¤å°¾éƒ¨çš„ / 
            if (processedHost.endsWith('/')) {
                processedHost = processedHost.slice(0, -1);
                changes.push('ç§»é™¤äº†å°¾éƒ¨çš„ /');
            }

            return { processedHost, changes, originalHost };
        }

        function toggleTimestampInput() {
            const timestampType = document.getElementById('timestampType').value;
            const datetimeInput = document.getElementById('datetimeInput');
            const directInput = document.getElementById('directInput');
            
            datetimeInput.style.display = 'none';
            directInput.style.display = 'none';
            
            if (timestampType === 'datetime') {
                datetimeInput.style.display = 'block';
            } else if (timestampType === 'direct') {
                directInput.style.display = 'block';
            }
        }

        async function calculateSignature() {
            // éšè—ä¹‹å‰çš„é€šçŸ¥
            hideNotification();
            
            const accessKey = document.getElementById('accessKey').value;
            const secretKey = document.getElementById('secretKey').value;
            const region = document.getElementById('region').value;
            const service = document.getElementById('service').value;
            const method = document.getElementById('method').value.toUpperCase();
            const hostInput = document.getElementById('host').value;
            const canonicalUri = document.getElementById('path').value || '/';
            const requestBody = document.getElementById('requestBody').value || '';
            
            // è°ƒè¯•ä¿¡æ¯ï¼šæ˜¾ç¤ºè·å–åˆ°çš„requestBody
            console.log('â–¶ åŸå§‹è·å–çš„requestBody:', requestBody);
            console.log('â–¶ å½“å‰method:', method);
            
            // å¤„ç† Host è¾“å…¥
            const { processedHost: host, changes } = processHost(hostInput);
            
            // å¦‚æœæœ‰å˜æ›´ï¼Œæ˜¾ç¤ºé€šçŸ¥
            if (changes.length > 0) {
                showNotification(`Host å·²è‡ªåŠ¨å¤„ç†: ${changes.join(', ')} (åŸå§‹: ${hostInput} â†’ å¤„ç†å: ${host})`);
            }
            
            // å¤„ç†æ—¶é—´æˆ³è¾“å…¥
            const timestampType = document.getElementById('timestampType').value;
            let targetDate;
            let amzDate;
            
            if (timestampType === 'direct') {
                const directTimestamp = document.getElementById('directTimestamp').value;
                if (directTimestamp && /^[0-9]{8}T[0-9]{6}Z$/.test(directTimestamp)) {
                    amzDate = directTimestamp;
                    // ä»TOSæ ¼å¼è½¬æ¢ä¸ºDateå¯¹è±¡ç”¨äºæ˜¾ç¤º
                    const year = directTimestamp.substring(0, 4);
                    const month = directTimestamp.substring(4, 6);
                    const day = directTimestamp.substring(6, 8);
                    const hour = directTimestamp.substring(9, 11);
                    const minute = directTimestamp.substring(11, 13);
                    const second = directTimestamp.substring(13, 15);
                    targetDate = new Date(`${year}-${month}-${day}T${hour}:${minute}:${second}Z`);
                } else {
                    alert('è¯·è¾“å…¥æ­£ç¡®çš„TOSæ—¶é—´æˆ³æ ¼å¼ï¼Œå¦‚: 20250812T142648Z');
                    return;
                }
            } else if (timestampType === 'datetime') {
                const customTimestamp = document.getElementById('customTimestamp').value;
                if (customTimestamp) {
                    targetDate = new Date(customTimestamp);
                    amzDate = targetDate.toISOString().replace(/[:-]|\.\d{3}/g, "");
                } else {
                    alert('è¯·é€‰æ‹©æ—¥æœŸæ—¶é—´');
                    return;
                }
            } else {
                // ä½¿ç”¨å½“å‰æ—¶é—´
                targetDate = new Date();
                amzDate = targetDate.toISOString().replace(/[:-]|\.\d{3}/g, "");
            }

            const dateStamp = amzDate.substr(0, 8);

            const paramRows = document.querySelectorAll('.param-row');
            const params = [];
            paramRows.forEach(row => {
                const keyInput = row.querySelector('.param-key');
                const valueInput = row.querySelector('.param-value');
                if (keyInput && valueInput) {
                    const key = keyInput.value;
                    const value = valueInput.value;
                    if (key) {
                        params.push({ key, value: value || '' });
                    }
                }
            });

            params.sort((a, b) => a.key.localeCompare(b.key));

            const canonicalQueryString = params
                .map(p => `${encodeURIComponent(p.key)}=${encodeURIComponent(p.value)}`)
                .join('&');

            // æ”¶é›†è‡ªå®šä¹‰ headers
            const headerRows = document.querySelectorAll('#customHeaders .param-row');
            const customHeaders = [];
            headerRows.forEach(row => {
                const keyInput = row.querySelector('.header-key');
                const valueInput = row.querySelector('.header-value');
                if (keyInput && valueInput) {
                    const key = keyInput.value;
                    const value = valueInput.value;
                    if (key && value) {
                        customHeaders.push({ key: key.trim(), value: value.trim() });
                    }
                }
            });

            let payloadHash;
            
            if (requestBody && method !== 'GET' && method !== 'HEAD') {
                // ç›´æ¥ä½¿ç”¨åŸå§‹çš„è¯·æ±‚ä½“å†…å®¹è®¡ç®—hashï¼Œä¿æŒç”¨æˆ·è¾“å…¥çš„æ ¼å¼
                // è¿™æ ·å¯ä»¥ç¡®ä¿hashå€¼ä¸å®é™…å‘é€çš„æ•°æ®ä¸€è‡´
                payloadHash = CryptoJS.SHA256(requestBody).toString(CryptoJS.enc.Hex);
            } else if (method === 'PUT' && !requestBody) {
                payloadHash = 'UNSIGNED-PAYLOAD';
            } else {
                payloadHash = CryptoJS.SHA256("").toString(CryptoJS.enc.Hex);
            }

            // æ„é€ æ‰€æœ‰éœ€è¦ç­¾åçš„ headers
            const allHeaders = [
                { key: 'host', value: host },
                { key: 'x-tos-date', value: amzDate },
                { key: 'x-tos-content-sha256', value: payloadHash }
            ];

            // æ·»åŠ è‡ªå®šä¹‰ headersï¼ˆåªåŒ…å«ç¬¦åˆ TOS è¦æ±‚çš„ headersï¼‰
            customHeaders.forEach(header => {
                const name = header.key.toLowerCase();
                // åŒ…å« x-tos-meta-* headers å’Œå…¶ä»–éœ€è¦ç­¾åçš„ headers
                if (name.startsWith("x-tos-meta-") || 
                    ["authorization", "content-type", "content-md5"].includes(name)) {
                    allHeaders.push(header);
                }
            });

            console.log("â–¶ Webç‰ˆæœ¬ - All headers before sort:", allHeaders.map(h => `${h.key}: ${h.value}`));

            // æŒ‰ header åç§°æ’åº
            allHeaders.sort((a, b) => 
                a.key.toLowerCase().localeCompare(b.key.toLowerCase())
            );

            console.log("â–¶ Webç‰ˆæœ¬ - All headers after sort:", allHeaders.map(h => `${h.key}: ${h.value}`));

            // æ„é€  canonical headers å­—ç¬¦ä¸²
            const canonicalHeaders = allHeaders
                .map(h => `${h.key.toLowerCase()}:${h.value.trim()}\n`)
                .join("");

            // æ„é€  signed headers åˆ—è¡¨
            const signedHeaders = allHeaders
                .map(h => h.key.toLowerCase())
                .join(";");

            console.log("â–¶ Webç‰ˆæœ¬ - canonicalHeaders:\\n", JSON.stringify(canonicalHeaders));
            console.log("â–¶ Webç‰ˆæœ¬ - signedHeaders:", signedHeaders);

            const canonicalRequest = [
                method,
                canonicalUri,
                canonicalQueryString,
                canonicalHeaders,
                signedHeaders,
                payloadHash
            ].join("\n");

            console.log("â–¶ Webç‰ˆæœ¬ - method:", method);
            console.log("â–¶ Webç‰ˆæœ¬ - canonicalUri:", canonicalUri);
            console.log("â–¶ Webç‰ˆæœ¬ - canonicalQueryString:", canonicalQueryString);
            console.log("â–¶ Webç‰ˆæœ¬ - payloadHash:", payloadHash);
            console.log("â–¶ Webç‰ˆæœ¬ - canonicalRequest:\\n", canonicalRequest);

            const algorithm = "TOS4-HMAC-SHA256";
            const credentialScope = `${dateStamp}/${region}/${service}/request`;
            const hashCR = CryptoJS.SHA256(canonicalRequest).toString(CryptoJS.enc.Hex);
            const stringToSign = [
                algorithm,
                amzDate,
                credentialScope,
                hashCR
            ].join("\n");

            console.log("â–¶ Webç‰ˆæœ¬ - algorithm:", algorithm);
            console.log("â–¶ Webç‰ˆæœ¬ - credentialScope:", credentialScope);
            console.log("â–¶ Webç‰ˆæœ¬ - hashCR:", hashCR);
            console.log("â–¶ Webç‰ˆæœ¬ - stringToSign:\\n", stringToSign);

            const kDate = CryptoJS.HmacSHA256(dateStamp, secretKey);
            const kRegion = CryptoJS.HmacSHA256(region, kDate);
            const kService = CryptoJS.HmacSHA256(service, kRegion);
            const kSigning = CryptoJS.HmacSHA256("request", kService);

            const signature = CryptoJS.HmacSHA256(stringToSign, kSigning).toString(CryptoJS.enc.Hex);

            console.log("â–¶ Webç‰ˆæœ¬ - kSigning (hex):", kSigning.toString(CryptoJS.enc.Hex));
            console.log("â–¶ Webç‰ˆæœ¬ - signature:", signature);

            const authHeader = 
                `${algorithm} ` +
                `Credential=${accessKey}/${credentialScope}, ` +
                `SignedHeaders=${signedHeaders}, ` +
                `Signature=${signature}`;

            console.log("â–¶ Webç‰ˆæœ¬ - Authorization:", authHeader);

            // å¡«å……è¾“å‡ºä¿¡æ¯
            document.getElementById('basicParamsOutput').textContent = 
                `HTTP Method: ${method}\nHost: ${host}${hostInput !== host ? ` (åŸå§‹: ${hostInput})` : ''}\nPath: ${canonicalUri}\nRegion: ${region}\nService: ${service}\nAccess Key: ${accessKey}`;
                
            document.getElementById('timestampOutput').textContent = 
                `æ—¶é—´æˆ³ç±»å‹: ${timestampType === 'current' ? 'å½“å‰æ—¶é—´' : timestampType === 'datetime' ? 'é€‰æ‹©æ—¶é—´' : 'TOSæ ¼å¼'}\nåŸå§‹æ—¶é—´: ${targetDate.toISOString()}\nTOSæ—¶é—´æˆ³: ${amzDate}\nDate Stamp: ${dateStamp}`;

            document.getElementById('payloadHashOutput').textContent = 
                `Request Body: ${requestBody ? `"${requestBody}"` : '(ç©º)'}\né•¿åº¦: ${requestBody ? requestBody.length : 0} å­—ç¬¦\nPayload Hashç®—æ³•: SHA256\nPayload Hash: ${payloadHash}\n\næ³¨æ„: Hashè®¡ç®—ä½¿ç”¨åŸå§‹è¾“å…¥æ ¼å¼ï¼Œä¿æŒæ¢è¡Œå’Œç©ºæ ¼`;

            document.getElementById('queryParamsOutput').textContent = 
                `å‚æ•°æ•°é‡: ${params.length}\nå‚æ•°è¯¦æƒ…: ${params.length > 0 ? params.map(p => `${p.key}=${p.value}`).join(', ') : '(æ— å‚æ•°)'}\nCanonical Query String: "${canonicalQueryString}"`;
                
            document.getElementById('headersToSignOutput').textContent = 
                `éœ€ç­¾åHeadersæ•°é‡: ${allHeaders.length}\nHeadersåˆ—è¡¨:\n${allHeaders.map(h => `  ${h.key}: ${h.value}`).join('\n')}\n\nSigned Headers: ${signedHeaders}\n\nCanonical Headers:\n${canonicalHeaders}`;
                
            document.getElementById('canonicalRequestOutput').textContent = canonicalRequest;
            
            document.getElementById('stringToSignOutput').textContent = 
                `ç®—æ³•: ${algorithm}\næ—¶é—´æˆ³: ${amzDate}\nå‡­è¯èŒƒå›´: ${credentialScope}\nCanonical Request Hash: ${hashCR}\n\nString To Sign:\n${stringToSign}`;

            document.getElementById('keyDerivationOutput').textContent = 
                `1. kDate = HMAC-SHA256("${dateStamp}", SecretKey)\n2. kRegion = HMAC-SHA256("${region}", kDate)\n3. kService = HMAC-SHA256("${service}", kRegion)\n4. kSigning = HMAC-SHA256("request", kService)\n\nkSigning (Hex): ${kSigning.toString(CryptoJS.enc.Hex)}`;

            document.getElementById('signatureOutput').textContent = 
                `ç­¾åç®—æ³•: HMAC-SHA256\nç­¾åè¾“å…¥: String To Sign\nç­¾åå¯†é’¥: kSigning\n\næœ€ç»ˆç­¾å: ${signature}`;

            document.getElementById('authHeaderOutput').textContent = authHeader;

            // ç”Ÿæˆ cURL è¯·æ±‚
            const curlRequest = generateCurlRequest({
                method,
                host,
                path: canonicalUri,
                requestBody,
                authHeader,
                amzDate,
                payloadHash,
                customHeaders,
                canonicalQueryString
            });
            
            document.getElementById('curlRequestOutput').textContent = curlRequest;

            // ç”Ÿæˆ Python3 ä»£ç 
            const pythonCode = generatePythonCode({
                method,
                host,
                path: canonicalUri,
                requestBody,
                customHeaders,
                canonicalQueryString,
                accessKey,
                secretKey,
                region,
                service
            });
            
            document.getElementById('pythonCodeOutput').textContent = pythonCode;

            // ç”Ÿæˆ Golang ä»£ç 
            const golangCode = generateGolangCode({
                method,
                host,
                path: canonicalUri,
                requestBody,
                customHeaders,
                canonicalQueryString,
                accessKey,
                secretKey,
                region,
                service
            });
            
            document.getElementById('golangCodeOutput').textContent = golangCode;

            // ç”Ÿæˆ Java ä»£ç 
            const javaCode = generateJavaCode({
                method,
                host,
                path: canonicalUri,
                requestBody,
                customHeaders,
                canonicalQueryString,
                accessKey,
                secretKey,
                region,
                service
            });
            
            document.getElementById('javaCodeOutput').textContent = javaCode;

            // ç”Ÿæˆ Node.js ä»£ç 
            const nodejsCode = generateNodejsCode({
                method,
                host,
                path: canonicalUri,
                requestBody,
                customHeaders,
                canonicalQueryString,
                accessKey,
                secretKey,
                region,
                service
            });
            
            document.getElementById('nodejsCodeOutput').textContent = nodejsCode;

            // å‡†å¤‡æµç¨‹å›¾æ•°æ®
            const flowchartData = {
                accessKey,
                secretKey,
                method,
                host,
                path: canonicalUri,
                region,
                service,
                timestampType: timestampType === 'current' ? 'å½“å‰æ—¶é—´' : timestampType === 'datetime' ? 'é€‰æ‹©æ—¶é—´' : 'TOSæ ¼å¼',
                originalTime: targetDate.toISOString(),
                amzDate,
                dateStamp,
                requestBody: requestBody || '(ç©º)',
                payloadHash,
                paramCount: params.length,
                paramDetails: params.length > 0 ? params.map(p => `${p.key}=${p.value}`).join(', ') : '(æ— å‚æ•°)',
                canonicalQueryString,
                headerCount: allHeaders.length,
                signedHeaders,
                canonicalHeaders,
                canonicalRequest,
                algorithm,
                credentialScope,
                hashCR,
                stringToSign,
                kSigning: kSigning.toString(CryptoJS.enc.Hex),
                signature,
                authHeader
            };

            // æ¸²æŸ“æµç¨‹å›¾
            await renderFlowchart(flowchartData);

            // æ˜¾ç¤ºæ•´ä¸ªç»“æœå®¹å™¨
            document.getElementById('results-panel').style.display = 'block';
            document.getElementById('flowchart-section').style.display = 'block';
            document.getElementById('code-examples-section').style.display = 'block';
        }

        // ç”Ÿæˆ Python3 ä»£ç 
        function generatePythonCode(options) {
            const { method, host, path, requestBody, customHeaders, canonicalQueryString, accessKey, secretKey, region, service } = options;
            
            // æ„å»ºæŸ¥è¯¢å‚æ•°ä»£ç 
            let queryParamsCode = '';
            if (canonicalQueryString) {
                const params = canonicalQueryString.split('&').map(param => {
                    const [key, value = ''] = param.split('=');
                    return `    '${decodeURIComponent(key)}': '${decodeURIComponent(value)}',`;
                }).join('\n');
                queryParamsCode = `query_params = {\n${params}\n}`;
            } else {
                queryParamsCode = `query_params = {}`;
            }
            
            // å¤„ç†è‡ªå®šä¹‰headers
            let customHeadersCode = '';
            if (customHeaders && customHeaders.length > 0) {
                const headersStr = customHeaders.map(header => 
                    `    '${header.key}': '${header.value}',`
                ).join('\n');
                customHeadersCode = `custom_headers = {\n${headersStr}\n}`;
            } else {
                customHeadersCode = `custom_headers = {}`;
            }
            
            // å¤„ç†è¯·æ±‚ä½“
            let bodyCode = '';
            let dataParam = '';
            if (requestBody && method !== 'GET' && method !== 'HEAD') {
                bodyCode = `request_body = '''${requestBody}'''`;
                dataParam = ', data=request_body';
            } else {
                bodyCode = `request_body = ''`;
            }
            
            return `#!/usr/bin/env python3
# -*- coding: utf-8 -*-
"""
TOS API ç­¾åè¯·æ±‚ç¤ºä¾‹ - Python3 å®Œæ•´å®ç°
åŒ…å«å®Œæ•´çš„ TOS4-HMAC-SHA256 ç­¾åç®—æ³•
å®‰è£…ä¾èµ–: pip install requests
"""

import requests
import hashlib
import hmac
from datetime import datetime
from urllib.parse import quote, urlencode
import json

def calculate_tos_signature():
    # é…ç½®å‚æ•°
    access_key = '${accessKey}'
    secret_key = '${secretKey}'
    region = '${region}'
    service = '${service}'
    
    # è¯·æ±‚å‚æ•°
    method = '${method}'
    host = '${host}'
    canonical_uri = '${path}'
    ${bodyCode}
    
    # æŸ¥è¯¢å‚æ•°
    ${queryParamsCode}
    
    # è‡ªå®šä¹‰Headers
    ${customHeadersCode}
    
    # ç”Ÿæˆæ—¶é—´æˆ³
    now = datetime.utcnow()
    amz_date = now.strftime('%Y%m%dT%H%M%SZ')
    date_stamp = now.strftime('%Y%m%d')
    
    # 1. è®¡ç®— Payload Hash
    if request_body and method not in ['GET', 'HEAD']:
        payload_hash = hashlib.sha256(request_body.encode('utf-8')).hexdigest()
    elif method == 'PUT' and not request_body:
        payload_hash = 'UNSIGNED-PAYLOAD'
    else:
        payload_hash = hashlib.sha256(b'').hexdigest()
    
    # 2. æ„é€ æŸ¥è¯¢å­—ç¬¦ä¸²
    if query_params:
        # æŒ‰é”®æ’åºå¹¶URLç¼–ç 
        sorted_params = sorted(query_params.items())
        canonical_query_string = '&'.join([f"{quote(k, safe='')}={quote(str(v), safe='')}" for k, v in sorted_params])
    else:
        canonical_query_string = ''
    
    # 3. æ„é€ Headers
    headers = {
        'host': host,
        'x-tos-date': amz_date,
        'x-tos-content-sha256': payload_hash
    }
    
    # æ·»åŠ è‡ªå®šä¹‰headers
    for key, value in custom_headers.items():
        headers[key.lower()] = value
    
    # æ·»åŠ Content-Typeï¼ˆå¦‚æœæœ‰è¯·æ±‚ä½“ä¸”æœªæŒ‡å®šï¼‰
    if request_body and method not in ['GET', 'HEAD'] and 'content-type' not in headers:
        headers['content-type'] = 'application/json'
    
    # æŒ‰é”®æ’åº
    sorted_headers = sorted(headers.items())
    
    # æ„é€ canonical headerså’Œsigned headers
    canonical_headers = '\\n'.join([f"{k}:{v}" for k, v in sorted_headers]) + '\\n'
    signed_headers = ';'.join([k for k, v in sorted_headers])
    
    # 4. æ„é€  Canonical Request
    canonical_request = '\\n'.join([
        method,
        canonical_uri,
        canonical_query_string,
        canonical_headers,
        signed_headers,
        payload_hash
    ])
    
    print(f"Canonical Request:\\n{canonical_request}\\n")
    
    # 5. æ„é€  String to Sign
    algorithm = 'TOS4-HMAC-SHA256'
    credential_scope = f"{date_stamp}/{region}/{service}/request"
    string_to_sign = '\\n'.join([
        algorithm,
        amz_date,
        credential_scope,
        hashlib.sha256(canonical_request.encode('utf-8')).hexdigest()
    ])
    
    print(f"String to Sign:\\n{string_to_sign}\\n")
    
    # 6. è®¡ç®—ç­¾å
    def sign(key, msg):
        return hmac.new(key, msg.encode('utf-8'), hashlib.sha256).digest()
    
    def get_signature_key(key, date_stamp, region_name, service_name):
        k_date = sign(key.encode('utf-8'), date_stamp)
        k_region = sign(k_date, region_name)
        k_service = sign(k_region, service_name)
        k_signing = sign(k_service, 'request')
        return k_signing
    
    signing_key = get_signature_key(secret_key, date_stamp, region, service)
    signature = hmac.new(signing_key, string_to_sign.encode('utf-8'), hashlib.sha256).hexdigest()
    
    print(f"Signature: {signature}\\n")
    
    # 7. æ„é€ Authorization header
    authorization_header = f"{algorithm} Credential={access_key}/{credential_scope}, SignedHeaders={signed_headers}, Signature={signature}"
    
    # 8. å‡†å¤‡æœ€ç»ˆè¯·æ±‚
    final_headers = {}
    for k, v in headers.items():
        # è½¬æ¢å›åŸå§‹å¤§å°å†™æ ¼å¼
        if k == 'host':
            final_headers['Host'] = v
        elif k == 'x-tos-date':
            final_headers['x-tos-date'] = v
        elif k == 'x-tos-content-sha256':
            final_headers['x-tos-content-sha256'] = v
        else:
            final_headers[k] = v
    
    final_headers['Authorization'] = authorization_header
    
    # æ„é€ å®Œæ•´URL
    url = f"https://{host}{canonical_uri}"
    if canonical_query_string:
        url += f"?{canonical_query_string}"
    
    print(f"Final URL: {url}")
    print(f"Final Headers: {json.dumps(final_headers, indent=2)}\\n")
    
    # 9. å‘é€è¯·æ±‚
    try:
        response = requests.request(method, url, headers=final_headers${dataParam})
        print(f"Status Code: {response.status_code}")
        print(f"Response Headers: {dict(response.headers)}")
        
        # æ ¹æ®å“åº”ç±»å‹å¤„ç†å†…å®¹
        content_type = response.headers.get('content-type', '').lower()
        if 'application/json' in content_type:
            try:
                print(f"Response JSON: {response.json()}")
            except:
                print(f"Response Text: {response.text}")
        elif 'text/' in content_type:
            print(f"Response Text: {response.text}")
        else:
            print(f"Response Content Length: {len(response.content)} bytes")
            # å¯¹äºäºŒè¿›åˆ¶å†…å®¹ï¼Œå¯ä»¥ä¿å­˜åˆ°æ–‡ä»¶
            # with open('downloaded_file', 'wb') as f:
            #     f.write(response.content)
            #     print("æ–‡ä»¶å·²ä¿å­˜ä¸º downloaded_file")
            
    except requests.exceptions.RequestException as e:
        print(f"è¯·æ±‚å¤±è´¥: {e}")

if __name__ == '__main__':
    calculate_tos_signature()`;
        }

        // ç”Ÿæˆ Golang ä»£ç 
        function generateGolangCode(options) {
            const { method, host, path, requestBody, customHeaders, canonicalQueryString, accessKey, secretKey, region, service } = options;
            
            // æ„å»ºæŸ¥è¯¢å‚æ•°ä»£ç 
            let queryParamsCode = '';
            if (canonicalQueryString) {
                const params = canonicalQueryString.split('&').map(param => {
                    const [key, value = ''] = param.split('=');
                    return `\t\t"${decodeURIComponent(key)}": "${decodeURIComponent(value)}",`;
                }).join('\n');
                queryParamsCode = `\tqueryParams := map[string]string{\n${params}\n\t}`;
            } else {
                queryParamsCode = `\tqueryParams := map[string]string{}`;
            }
            
            // å¤„ç†è‡ªå®šä¹‰headers
            let customHeadersCode = '';
            if (customHeaders && customHeaders.length > 0) {
                const headersStr = customHeaders.map(header => 
                    `\t\t"${header.key}": "${header.value}",`
                ).join('\n');
                customHeadersCode = `\tcustomHeaders := map[string]string{\n${headersStr}\n\t}`;
            } else {
                customHeadersCode = `\tcustomHeaders := map[string]string{}`;
            }
            
            // å¤„ç†è¯·æ±‚ä½“
            let bodyCode = '';
            if (requestBody && method !== 'GET' && method !== 'HEAD') {
                bodyCode = `\trequestBody := \`${requestBody}\``;
            } else {
                bodyCode = `\trequestBody := ""`;
            }
            
            return `package main

import (
\t"crypto/hmac"
\t"crypto/sha256"
\t"encoding/hex"
\t"fmt"
\t"io"
\t"net/http"
\t"net/url"
\t"sort"
\t"strings"
\t"time"
)

// TOS API ç­¾åè¯·æ±‚ç¤ºä¾‹ - Golang å®Œæ•´å®ç°
// åŒ…å«å®Œæ•´çš„ TOS4-HMAC-SHA256 ç­¾åç®—æ³•
// ä½¿ç”¨æ ‡å‡†åº“ net/http å‘é€ HTTP è¯·æ±‚

func main() {
\t// é…ç½®å‚æ•°
\taccessKey := "${accessKey}"
\tsecretKey := "${secretKey}"
\tregion := "${region}"
\tservice := "${service}"
\t
\t// è¯·æ±‚å‚æ•°
\tmethod := "${method}"
\thost := "${host}"
\tcanonicalURI := "${path}"
\t${bodyCode}
\t
\t// æŸ¥è¯¢å‚æ•°
${queryParamsCode}
\t
\t// è‡ªå®šä¹‰Headers
${customHeadersCode}
\t
\t// ç”Ÿæˆæ—¶é—´æˆ³
\tnow := time.Now().UTC()
\tamzDate := now.Format("20060102T150405Z")
\tdateStamp := now.Format("20060102")
\t
\t// 1. è®¡ç®— Payload Hash
\tvar payloadHash string
\tif requestBody != "" && method != "GET" && method != "HEAD" {
\t\thash := sha256.Sum256([]byte(requestBody))
\t\tpayloadHash = hex.EncodeToString(hash[:])
\t} else if method == "PUT" && requestBody == "" {
\t\tpayloadHash = "UNSIGNED-PAYLOAD"
\t} else {
\t\thash := sha256.Sum256([]byte(""))
\t\tpayloadHash = hex.EncodeToString(hash[:])
\t}
\t
\t// 2. æ„é€ æŸ¥è¯¢å­—ç¬¦ä¸²
\tvar canonicalQueryString string
\tif len(queryParams) > 0 {
\t\t// æŒ‰é”®æ’åºå¹¶URLç¼–ç 
\t\tkeys := make([]string, 0, len(queryParams))
\t\tfor k := range queryParams {
\t\t\tkeys = append(keys, k)
\t\t}
\t\tsort.Strings(keys)
\t\t
\t\tqueryParts := make([]string, 0, len(keys))
\t\tfor _, k := range keys {
\t\t\tqueryParts = append(queryParts, url.QueryEscape(k)+"="+url.QueryEscape(queryParams[k]))
\t\t}
\t\tcanonicalQueryString = strings.Join(queryParts, "&")
\t}
\t
\t// 3. æ„é€ Headers
\theaders := map[string]string{
\t\t"host":                   host,
\t\t"x-tos-date":            amzDate,
\t\t"x-tos-content-sha256":  payloadHash,
\t}
\t
\t// æ·»åŠ è‡ªå®šä¹‰headers
\tfor key, value := range customHeaders {
\t\theaders[strings.ToLower(key)] = value
\t}
\t
\t// æ·»åŠ Content-Typeï¼ˆå¦‚æœæœ‰è¯·æ±‚ä½“ä¸”æœªæŒ‡å®šï¼‰
\tif requestBody != "" && method != "GET" && method != "HEAD" {
\t\tif _, exists := headers["content-type"]; !exists {
\t\t\theaders["content-type"] = "application/json"
\t\t}
\t}
\t
\t// æŒ‰é”®æ’åº
\theaderKeys := make([]string, 0, len(headers))
\tfor k := range headers {
\t\theaderKeys = append(headerKeys, k)
\t}
\tsort.Strings(headerKeys)
\t
\t// æ„é€ canonical headerså’Œsigned headers
\tcanonicalHeaders := ""
\tfor _, k := range headerKeys {
\t\tcanonicalHeaders += k + ":" + headers[k] + "\\n"
\t}
\tsignedHeaders := strings.Join(headerKeys, ";")
\t
\t// 4. æ„é€  Canonical Request
\tcanonicalRequest := strings.Join([]string{
\t\tmethod,
\t\tcanonicalURI,
\t\tcanonicalQueryString,
\t\tcanonicalHeaders,
\t\tsignedHeaders,
\t\tpayloadHash,
\t}, "\\n")
\t
\tfmt.Printf("Canonical Request:\\n%s\\n\\n", canonicalRequest)
\t
\t// 5. æ„é€  String to Sign
\talgorithm := "TOS4-HMAC-SHA256"
\tcredentialScope := fmt.Sprintf("%s/%s/%s/request", dateStamp, region, service)
\t
\thash := sha256.Sum256([]byte(canonicalRequest))
\tstringToSign := strings.Join([]string{
\t\talgorithm,
\t\tamzDate,
\t\tcredentialScope,
\t\thex.EncodeToString(hash[:]),
\t}, "\\n")
\t
\tfmt.Printf("String to Sign:\\n%s\\n\\n", stringToSign)
\t
\t// 6. è®¡ç®—ç­¾å
\tsign := func(key []byte, msg string) []byte {
\t\th := hmac.New(sha256.New, key)
\t\th.Write([]byte(msg))
\t\treturn h.Sum(nil)
\t}
\t
\tgetSignatureKey := func(key, dateStamp, regionName, serviceName string) []byte {
\t\tkDate := sign([]byte(key), dateStamp)
\t\tkRegion := sign(kDate, regionName)
\t\tkService := sign(kRegion, serviceName)
\t\tkSigning := sign(kService, "request")
\t\treturn kSigning
\t}
\t
\tsigningKey := getSignatureKey(secretKey, dateStamp, region, service)
\tsignature := hex.EncodeToString(sign(signingKey, stringToSign))
\t
\tfmt.Printf("Signature: %s\\n\\n", signature)
\t
\t// 7. æ„é€ Authorization header
\tauthorizationHeader := fmt.Sprintf("%s Credential=%s/%s, SignedHeaders=%s, Signature=%s",
\t\talgorithm, accessKey, credentialScope, signedHeaders, signature)
\t
\t// 8. å‡†å¤‡æœ€ç»ˆè¯·æ±‚
\tfinalURL := fmt.Sprintf("https://%s%s", host, canonicalURI)
\tif canonicalQueryString != "" {
\t\tfinalURL += "?" + canonicalQueryString
\t}
\t
\t// æ„é€ è¯·æ±‚ä½“
\tvar bodyReader io.Reader
\tif requestBody != "" && method != "GET" && method != "HEAD" {
\t\tbodyReader = strings.NewReader(requestBody)
\t}
\t
\treq, err := http.NewRequest(method, finalURL, bodyReader)
\tif err != nil {
\t\tfmt.Printf("åˆ›å»ºè¯·æ±‚å¤±è´¥: %v\\n", err)
\t\treturn
\t}
\t
\t// è®¾ç½®headers
\tfor k, v := range headers {
\t\t// è½¬æ¢å›åŸå§‹å¤§å°å†™æ ¼å¼
\t\tswitch k {
\t\tcase "host":
\t\t\treq.Header.Set("Host", v)
\t\tcase "x-tos-date":
\t\t\treq.Header.Set("x-tos-date", v)
\t\tcase "x-tos-content-sha256":
\t\t\treq.Header.Set("x-tos-content-sha256", v)
\t\tdefault:
\t\t\treq.Header.Set(k, v)
\t\t}
\t}
\treq.Header.Set("Authorization", authorizationHeader)
\t
\tfmt.Printf("Final URL: %s\\n", finalURL)
\tfmt.Printf("Final Headers: %v\\n\\n", req.Header)
\t
\t// 9. å‘é€è¯·æ±‚
\tclient := &http.Client{
\t\tTimeout: 30 * time.Second,
\t}
\t
\tresp, err := client.Do(req)
\tif err != nil {
\t\tfmt.Printf("è¯·æ±‚å¤±è´¥: %v\\n", err)
\t\treturn
\t}
\tdefer resp.Body.Close()
\t
\tfmt.Printf("Status Code: %d\\n", resp.StatusCode)
\tfmt.Printf("Response Headers: %v\\n", resp.Header)
\t
\t// è¯»å–å“åº”å†…å®¹
\tbody, err := io.ReadAll(resp.Body)
\tif err != nil {
\t\tfmt.Printf("è¯»å–å“åº”å¤±è´¥: %v\\n", err)
\t\treturn
\t}
\t
\t// æ ¹æ®å“åº”ç±»å‹å¤„ç†å†…å®¹
\tcontentType := resp.Header.Get("Content-Type")
\tif strings.Contains(strings.ToLower(contentType), "application/json") ||
\t   strings.Contains(strings.ToLower(contentType), "text/") {
\t\tfmt.Printf("Response Body: %s\\n", string(body))
\t} else {
\t\tfmt.Printf("Response Content Length: %d bytes\\n", len(body))
\t\t// å¯¹äºäºŒè¿›åˆ¶å†…å®¹ï¼Œå¯ä»¥ä¿å­˜åˆ°æ–‡ä»¶
\t\t// err = os.WriteFile("downloaded_file", body, 0644)
\t\t// if err != nil {
\t\t//     fmt.Printf("ä¿å­˜æ–‡ä»¶å¤±è´¥: %v\\n", err)
\t\t// } else {
\t\t//     fmt.Printf("æ–‡ä»¶å·²ä¿å­˜ä¸º downloaded_file\\n")
\t\t// }
\t}
}`;
        }

        // ç”Ÿæˆ Java ä»£ç 
        function generateJavaCode(options) {
            const { method, host, path, requestBody, customHeaders, canonicalQueryString, accessKey, secretKey, region, service } = options;
            
            // æ„å»ºæŸ¥è¯¢å‚æ•°ä»£ç 
            let queryParamsCode = '';
            if (canonicalQueryString) {
                const params = canonicalQueryString.split('&').map(param => {
                    const [key, value = ''] = param.split('=');
                    return `        queryParams.put("${decodeURIComponent(key)}", "${decodeURIComponent(value)}");`;
                }).join('\n');
                queryParamsCode = `        Map<String, String> queryParams = new HashMap<>();\n${params}`;
            } else {
                queryParamsCode = `        Map<String, String> queryParams = new HashMap<>();`;
            }
            
            // å¤„ç†è‡ªå®šä¹‰headers
            let customHeadersCode = '';
            if (customHeaders && customHeaders.length > 0) {
                const headersStr = customHeaders.map(header => 
                    `        customHeaders.put("${header.key}", "${header.value}");`
                ).join('\n');
                customHeadersCode = `        Map<String, String> customHeaders = new HashMap<>();\n${headersStr}`;
            } else {
                customHeadersCode = `        Map<String, String> customHeaders = new HashMap<>();`;
            }
            
            // å¤„ç†è¯·æ±‚ä½“
            let bodyCode = '';
            if (requestBody && method !== 'GET' && method !== 'HEAD') {
                bodyCode = `        String requestBody = """${requestBody}""";`;
            } else {
                bodyCode = `        String requestBody = "";`;
            }
            
            return `import java.io.*;
import java.net.URI;
import java.net.URLEncoder;
import java.net.http.HttpClient;
import java.net.http.HttpRequest;
import java.net.http.HttpResponse;
import java.nio.charset.StandardCharsets;
import java.security.MessageDigest;
import java.text.SimpleDateFormat;
import java.time.Duration;
import java.util.*;
import javax.crypto.Mac;
import javax.crypto.spec.SecretKeySpec;

/**
 * TOS API ç­¾åè¯·æ±‚ç¤ºä¾‹ - Java å®Œæ•´å®ç°
 * åŒ…å«å®Œæ•´çš„ TOS4-HMAC-SHA256 ç­¾åç®—æ³•
 * ä½¿ç”¨ Java 11+ çš„ HttpClient å‘é€ HTTP è¯·æ±‚
 * 
 * ç¼–è¯‘è¿è¡Œ:
 * javac TOSSignatureExample.java
 * java TOSSignatureExample
 */
public class TOSSignatureExample {
    
    public static void main(String[] args) {
        try {
            // é…ç½®å‚æ•°
            String accessKey = "${accessKey}";
            String secretKey = "${secretKey}";
            String region = "${region}";
            String service = "${service}";
            
            // è¯·æ±‚å‚æ•°
            String method = "${method}";
            String host = "${host}";
            String canonicalUri = "${path}";
${bodyCode}
            
            // æŸ¥è¯¢å‚æ•°
${queryParamsCode}
            
            // è‡ªå®šä¹‰Headers
${customHeadersCode}
            
            // ç”Ÿæˆæ—¶é—´æˆ³
            SimpleDateFormat dateFormat = new SimpleDateFormat("yyyyMMdd'T'HHmmss'Z'");
            SimpleDateFormat dateStampFormat = new SimpleDateFormat("yyyyMMdd");
            dateFormat.setTimeZone(TimeZone.getTimeZone("UTC"));
            dateStampFormat.setTimeZone(TimeZone.getTimeZone("UTC"));
            
            Date now = new Date();
            String amzDate = dateFormat.format(now);
            String dateStamp = dateStampFormat.format(now);
            
            // 1. è®¡ç®— Payload Hash
            String payloadHash;
            if (!requestBody.isEmpty() && !method.equals("GET") && !method.equals("HEAD")) {
                payloadHash = sha256Hex(requestBody);
            } else if (method.equals("PUT") && requestBody.isEmpty()) {
                payloadHash = "UNSIGNED-PAYLOAD";
            } else {
                payloadHash = sha256Hex("");
            }
            
            // 2. æ„é€ æŸ¥è¯¢å­—ç¬¦ä¸²
            String canonicalQueryString = "";
            if (!queryParams.isEmpty()) {
                List<String> sortedKeys = new ArrayList<>(queryParams.keySet());
                Collections.sort(sortedKeys);
                
                List<String> queryParts = new ArrayList<>();
                for (String key : sortedKeys) {
                    queryParts.add(urlEncode(key) + "=" + urlEncode(queryParams.get(key)));
                }
                canonicalQueryString = String.join("&", queryParts);
            }
            
            // 3. æ„é€ Headers
            Map<String, String> headers = new TreeMap<>(); // TreeMapè‡ªåŠ¨æ’åº
            headers.put("host", host);
            headers.put("x-tos-date", amzDate);
            headers.put("x-tos-content-sha256", payloadHash);
            
            // æ·»åŠ è‡ªå®šä¹‰headers
            for (Map.Entry<String, String> entry : customHeaders.entrySet()) {
                headers.put(entry.getKey().toLowerCase(), entry.getValue());
            }
            
            // æ·»åŠ Content-Typeï¼ˆå¦‚æœæœ‰è¯·æ±‚ä½“ä¸”æœªæŒ‡å®šï¼‰
            if (!requestBody.isEmpty() && !method.equals("GET") && !method.equals("HEAD")) {
                if (!headers.containsKey("content-type")) {
                    headers.put("content-type", "application/json");
                }
            }
            
            // æ„é€ canonical headerså’Œsigned headers
            StringBuilder canonicalHeaders = new StringBuilder();
            List<String> signedHeadersList = new ArrayList<>();
            for (Map.Entry<String, String> entry : headers.entrySet()) {
                canonicalHeaders.append(entry.getKey()).append(":").append(entry.getValue()).append("\\n");
                signedHeadersList.add(entry.getKey());
            }
            String signedHeaders = String.join(";", signedHeadersList);
            
            // 4. æ„é€  Canonical Request
            String canonicalRequest = String.join("\\n",
                method,
                canonicalUri,
                canonicalQueryString,
                canonicalHeaders.toString(),
                signedHeaders,
                payloadHash
            );
            
            System.out.println("Canonical Request:\\n" + canonicalRequest + "\\n");
            
            // 5. æ„é€  String to Sign
            String algorithm = "TOS4-HMAC-SHA256";
            String credentialScope = dateStamp + "/" + region + "/" + service + "/request";
            String stringToSign = String.join("\\n",
                algorithm,
                amzDate,
                credentialScope,
                sha256Hex(canonicalRequest)
            );
            
            System.out.println("String to Sign:\\n" + stringToSign + "\\n");
            
            // 6. è®¡ç®—ç­¾å
            byte[] signingKey = getSignatureKey(secretKey, dateStamp, region, service);
            String signature = hmacSha256Hex(signingKey, stringToSign);
            
            System.out.println("Signature: " + signature + "\\n");
            
            // 7. æ„é€ Authorization header
            String authorizationHeader = String.format(
                "%s Credential=%s/%s, SignedHeaders=%s, Signature=%s",
                algorithm, accessKey, credentialScope, signedHeaders, signature
            );
            
            // 8. å‡†å¤‡æœ€ç»ˆè¯·æ±‚
            String finalUrl = "https://" + host + canonicalUri;
            if (!canonicalQueryString.isEmpty()) {
                finalUrl += "?" + canonicalQueryString;
            }
            
            HttpClient client = HttpClient.newBuilder()
                .connectTimeout(Duration.ofSeconds(30))
                .build();
            
            HttpRequest.Builder requestBuilder = HttpRequest.newBuilder()
                .uri(URI.create(finalUrl))
                .timeout(Duration.ofSeconds(30));
            
            // è®¾ç½®è¯·æ±‚æ–¹æ³•å’Œè¯·æ±‚ä½“
            if (!requestBody.isEmpty() && !method.equals("GET") && !method.equals("HEAD")) {
                requestBuilder.method(method, HttpRequest.BodyPublishers.ofString(requestBody));
            } else {
                requestBuilder.method(method, HttpRequest.BodyPublishers.noBody());
            }
            
            // è®¾ç½®headers
            for (Map.Entry<String, String> entry : headers.entrySet()) {
                String headerName = entry.getKey();
                // è½¬æ¢å›åŸå§‹å¤§å°å†™æ ¼å¼
                switch (headerName) {
                    case "host":
                        requestBuilder.header("Host", entry.getValue());
                        break;
                    case "x-tos-date":
                        requestBuilder.header("x-tos-date", entry.getValue());
                        break;
                    case "x-tos-content-sha256":
                        requestBuilder.header("x-tos-content-sha256", entry.getValue());
                        break;
                    default:
                        requestBuilder.header(headerName, entry.getValue());
                        break;
                }
            }
            requestBuilder.header("Authorization", authorizationHeader);
            
            HttpRequest request = requestBuilder.build();
            
            System.out.println("Final URL: " + finalUrl);
            System.out.println("Final Headers: " + request.headers().map() + "\\n");
            
            // 9. å‘é€è¯·æ±‚
            HttpResponse<String> response = client.send(request, HttpResponse.BodyHandlers.ofString());
            
            System.out.println("Status Code: " + response.statusCode());
            System.out.println("Response Headers: " + response.headers().map());
            
            // æ ¹æ®å“åº”ç±»å‹å¤„ç†å†…å®¹
            String contentType = response.headers().firstValue("content-type").orElse("").toLowerCase();
            if (contentType.contains("application/json") || contentType.contains("text/")) {
                System.out.println("Response Body: " + response.body());
            } else {
                System.out.println("Response Content Length: " + response.body().length() + " characters");
                // å¯¹äºäºŒè¿›åˆ¶å†…å®¹ï¼Œå¯ä»¥ä¿å­˜åˆ°æ–‡ä»¶
                // Files.write(Paths.get("downloaded_file"), response.body().getBytes());
                // System.out.println("æ–‡ä»¶å·²ä¿å­˜ä¸º downloaded_file");
            }
            
        } catch (Exception e) {
            System.err.println("è¯·æ±‚å¤±è´¥: " + e.getMessage());
            e.printStackTrace();
        }
    }
    
    // è®¡ç®— SHA256 å“ˆå¸Œå€¼
    private static String sha256Hex(String input) throws Exception {
        MessageDigest digest = MessageDigest.getInstance("SHA-256");
        byte[] hash = digest.digest(input.getBytes(StandardCharsets.UTF_8));
        return bytesToHex(hash);
    }
    
    // è®¡ç®— HMAC-SHA256
    private static byte[] hmacSha256(byte[] key, String data) throws Exception {
        Mac mac = Mac.getInstance("HmacSHA256");
        SecretKeySpec secretKeySpec = new SecretKeySpec(key, "HmacSHA256");
        mac.init(secretKeySpec);
        return mac.doFinal(data.getBytes(StandardCharsets.UTF_8));
    }
    
    // è®¡ç®— HMAC-SHA256 å¹¶è¿”å›åå…­è¿›åˆ¶å­—ç¬¦ä¸²
    private static String hmacSha256Hex(byte[] key, String data) throws Exception {
        return bytesToHex(hmacSha256(key, data));
    }
    
    // è·å–ç­¾åå¯†é’¥
    private static byte[] getSignatureKey(String key, String dateStamp, String regionName, String serviceName) throws Exception {
        byte[] kDate = hmacSha256(key.getBytes(StandardCharsets.UTF_8), dateStamp);
        byte[] kRegion = hmacSha256(kDate, regionName);
        byte[] kService = hmacSha256(kRegion, serviceName);
        byte[] kSigning = hmacSha256(kService, "request");
        return kSigning;
    }
    
    // å­—èŠ‚æ•°ç»„è½¬åå…­è¿›åˆ¶å­—ç¬¦ä¸²
    private static String bytesToHex(byte[] bytes) {
        StringBuilder result = new StringBuilder();
        for (byte b : bytes) {
            result.append(String.format("%02x", b));
        }
        return result.toString();
    }
    
    // URLç¼–ç 
    private static String urlEncode(String value) {
        try {
            return URLEncoder.encode(value, StandardCharsets.UTF_8.toString())
                .replace("+", "%20")
                .replace("*", "%2A")
                .replace("%7E", "~");
        } catch (Exception e) {
            throw new RuntimeException(e);
        }
    }
}`;
        }

        // ç”Ÿæˆ Node.js ä»£ç 
        function generateNodejsCode(options) {
            const { method, host, path, requestBody, customHeaders, canonicalQueryString, accessKey, secretKey, region, service } = options;
            
            // æ„å»ºæŸ¥è¯¢å‚æ•°ä»£ç 
            let queryParamsCode = '';
            if (canonicalQueryString) {
                const params = canonicalQueryString.split('&').map(param => {
                    const [key, value = ''] = param.split('=');
                    return `    '${decodeURIComponent(key)}': '${decodeURIComponent(value)}',`;
                }).join('\n');
                queryParamsCode = `const queryParams = {\n${params}\n};`;
            } else {
                queryParamsCode = `const queryParams = {};`;
            }
            
            // å¤„ç†è‡ªå®šä¹‰headers
            let customHeadersCode = '';
            if (customHeaders && customHeaders.length > 0) {
                const headersStr = customHeaders.map(header => 
                    `    '${header.key}': '${header.value}',`
                ).join('\n');
                customHeadersCode = `const customHeaders = {\n${headersStr}\n};`;
            } else {
                customHeadersCode = `const customHeaders = {};`;
            }
            
            // å¤„ç†è¯·æ±‚ä½“
            let bodyCode = '';
            if (requestBody && method !== 'GET' && method !== 'HEAD') {
                bodyCode = `const requestBody = \`${requestBody}\`;`;
            } else {
                bodyCode = `const requestBody = '';`;
            }
            
            return `#!/usr/bin/env node

/**
 * TOS API ç­¾åè¯·æ±‚ç¤ºä¾‹ - Node.js å®Œæ•´å®ç°
 * åŒ…å«å®Œæ•´çš„ TOS4-HMAC-SHA256 ç­¾åç®—æ³•
 * ä½¿ç”¨ Node.js å†…ç½®æ¨¡å—å‘é€ HTTP è¯·æ±‚
 * 
 * è¿è¡Œ: node tos-signature-example.js
 * ä¾èµ–: Node.js 14+ (ä½¿ç”¨å†…ç½®æ¨¡å—ï¼Œæ— éœ€é¢å¤–å®‰è£…ä¾èµ–)
 */

const crypto = require('crypto');
const https = require('https');
const { URL, URLSearchParams } = require('url');

async function calculateTOSSignature() {
    try {
        // é…ç½®å‚æ•°
        const accessKey = '${accessKey}';
        const secretKey = '${secretKey}';
        const region = '${region}';
        const service = '${service}';
        
        // è¯·æ±‚å‚æ•°
        const method = '${method}';
        const host = '${host}';
        const canonicalUri = '${path}';
        ${bodyCode}
        
        // æŸ¥è¯¢å‚æ•°
        ${queryParamsCode}
        
        // è‡ªå®šä¹‰Headers
        ${customHeadersCode}
        
        // ç”Ÿæˆæ—¶é—´æˆ³
        const now = new Date();
        const amzDate = now.toISOString().replace(/[:-]|\\.\\d{3}/g, '');
        const dateStamp = amzDate.substr(0, 8);
        
        // 1. è®¡ç®— Payload Hash
        let payloadHash;
        if (requestBody && method !== 'GET' && method !== 'HEAD') {
            payloadHash = crypto.createHash('sha256').update(requestBody, 'utf8').digest('hex');
        } else if (method === 'PUT' && !requestBody) {
            payloadHash = 'UNSIGNED-PAYLOAD';
        } else {
            payloadHash = crypto.createHash('sha256').update('', 'utf8').digest('hex');
        }
        
        // 2. æ„é€ æŸ¥è¯¢å­—ç¬¦ä¸²
        let canonicalQueryString = '';
        if (Object.keys(queryParams).length > 0) {
            const sortedKeys = Object.keys(queryParams).sort();
            const queryParts = sortedKeys.map(key => {
                return encodeURIComponent(key) + '=' + encodeURIComponent(queryParams[key]);
            });
            canonicalQueryString = queryParts.join('&');
        }
        
        // 3. æ„é€ Headers
        const headers = {
            'host': host,
            'x-tos-date': amzDate,
            'x-tos-content-sha256': payloadHash
        };
        
        // æ·»åŠ è‡ªå®šä¹‰headers
        for (const [key, value] of Object.entries(customHeaders)) {
            headers[key.toLowerCase()] = value;
        }
        
        // æ·»åŠ Content-Typeï¼ˆå¦‚æœæœ‰è¯·æ±‚ä½“ä¸”æœªæŒ‡å®šï¼‰
        if (requestBody && method !== 'GET' && method !== 'HEAD') {
            if (!headers['content-type']) {
                headers['content-type'] = 'application/json';
            }
        }
        
        // æŒ‰é”®æ’åº
        const sortedHeaders = Object.keys(headers).sort().reduce((result, key) => {
            result[key] = headers[key];
            return result;
        }, {});
        
        // æ„é€ canonical headerså’Œsigned headers
        const canonicalHeaders = Object.entries(sortedHeaders)
            .map(([key, value]) => \`\${key}:\${value}\\n\`)
            .join('');
        const signedHeaders = Object.keys(sortedHeaders).join(';');
        
        // 4. æ„é€  Canonical Request
        const canonicalRequest = [
            method,
            canonicalUri,
            canonicalQueryString,
            canonicalHeaders,
            signedHeaders,
            payloadHash
        ].join('\\n');
        
        console.log(\`Canonical Request:\\n\${canonicalRequest}\\n\`);
        
        // 5. æ„é€  String to Sign
        const algorithm = 'TOS4-HMAC-SHA256';
        const credentialScope = \`\${dateStamp}/\${region}/\${service}/request\`;
        const stringToSign = [
            algorithm,
            amzDate,
            credentialScope,
            crypto.createHash('sha256').update(canonicalRequest, 'utf8').digest('hex')
        ].join('\\n');
        
        console.log(\`String to Sign:\\n\${stringToSign}\\n\`);
        
        // 6. è®¡ç®—ç­¾å
        function sign(key, msg) {
            return crypto.createHmac('sha256', key).update(msg, 'utf8').digest();
        }
        
        function getSignatureKey(key, dateStamp, regionName, serviceName) {
            const kDate = sign(key, dateStamp);
            const kRegion = sign(kDate, regionName);
            const kService = sign(kRegion, serviceName);
            const kSigning = sign(kService, 'request');
            return kSigning;
        }
        
        const signingKey = getSignatureKey(secretKey, dateStamp, region, service);
        const signature = crypto.createHmac('sha256', signingKey)
            .update(stringToSign, 'utf8')
            .digest('hex');
        
        console.log(\`Signature: \${signature}\\n\`);
        
        // 7. æ„é€ Authorization header
        const authorizationHeader = \`\${algorithm} Credential=\${accessKey}/\${credentialScope}, SignedHeaders=\${signedHeaders}, Signature=\${signature}\`;
        
        // 8. å‡†å¤‡æœ€ç»ˆè¯·æ±‚
        let finalUrl = \`https://\${host}\${canonicalUri}\`;
        if (canonicalQueryString) {
            finalUrl += \`?\${canonicalQueryString}\`;
        }
        
        // æ„é€ æœ€ç»ˆheaders
        const finalHeaders = {};
        for (const [key, value] of Object.entries(sortedHeaders)) {
            // è½¬æ¢å›åŸå§‹å¤§å°å†™æ ¼å¼
            switch (key) {
                case 'host':
                    finalHeaders['Host'] = value;
                    break;
                case 'x-tos-date':
                    finalHeaders['x-tos-date'] = value;
                    break;
                case 'x-tos-content-sha256':
                    finalHeaders['x-tos-content-sha256'] = value;
                    break;
                default:
                    finalHeaders[key] = value;
                    break;
            }
        }
        finalHeaders['Authorization'] = authorizationHeader;
        
        // æ·»åŠ Content-Lengthï¼ˆå¦‚æœæœ‰è¯·æ±‚ä½“ï¼‰
        if (requestBody) {
            finalHeaders['Content-Length'] = Buffer.byteLength(requestBody, 'utf8');
        }
        
        console.log(\`Final URL: \${finalUrl}\`);
        console.log(\`Final Headers:\`, JSON.stringify(finalHeaders, null, 2));
        console.log('');
        
        // 9. å‘é€è¯·æ±‚
        const urlObj = new URL(finalUrl);
        const options = {
            hostname: urlObj.hostname,
            port: urlObj.port || 443,
            path: urlObj.pathname + urlObj.search,
            method: method,
            headers: finalHeaders,
            timeout: 30000
        };
        
        const response = await makeRequest(options, requestBody);
        
        console.log(\`Status Code: \${response.statusCode}\`);
        console.log(\`Response Headers:\`, response.headers);
        
        // æ ¹æ®å“åº”ç±»å‹å¤„ç†å†…å®¹
        const contentType = (response.headers['content-type'] || '').toLowerCase();
        if (contentType.includes('application/json')) {
            try {
                const jsonData = JSON.parse(response.body);
                console.log(\`Response JSON:\`, JSON.stringify(jsonData, null, 2));
            } catch (e) {
                console.log(\`Response Text: \${response.body}\`);
            }
        } else if (contentType.includes('text/')) {
            console.log(\`Response Text: \${response.body}\`);
        } else {
            console.log(\`Response Content Length: \${response.body.length} bytes\`);
            // å¯¹äºäºŒè¿›åˆ¶å†…å®¹ï¼Œå¯ä»¥ä¿å­˜åˆ°æ–‡ä»¶
            // const fs = require('fs');
            // fs.writeFileSync('downloaded_file', response.body);
            // console.log('æ–‡ä»¶å·²ä¿å­˜ä¸º downloaded_file');
        }
        
    } catch (error) {
        console.error('è¯·æ±‚å¤±è´¥:', error.message);
    }
}

// PromiseåŒ–çš„HTTPè¯·æ±‚
function makeRequest(options, data) {
    return new Promise((resolve, reject) => {
        const req = https.request(options, (res) => {
            let body = '';
            res.on('data', (chunk) => {
                body += chunk;
            });
            res.on('end', () => {
                resolve({
                    statusCode: res.statusCode,
                    headers: res.headers,
                    body: body
                });
            });
        });
        
        req.on('error', (error) => {
            reject(error);
        });
        
        req.on('timeout', () => {
            req.destroy();
            reject(new Error('Request timeout'));
        });
        
        if (data) {
            req.write(data);
        }
        
        req.end();
    });
}

// è¿è¡Œç¤ºä¾‹
if (require.main === module) {
    calculateTOSSignature();
}

module.exports = { calculateTOSSignature };`;
        }

        // ç”Ÿæˆ cURL è¯·æ±‚
        function generateCurlRequest(options) {
            const { method, host, path, requestBody, authHeader, amzDate, payloadHash, customHeaders, canonicalQueryString } = options;
            
            // æ„å»ºå®Œæ•´URL
            const protocol = 'https://';
            const fullUrl = protocol + host + path + (canonicalQueryString ? '?' + canonicalQueryString : '');
            
            // æ„å»ºcURLå‘½ä»¤
            let curlCommand = `curl -X ${method} \\\n  "${fullUrl}"`;
            
            // æ·»åŠ å¿…éœ€çš„headers
            curlCommand += ` \\\n  -H "Host: ${host}"`;
            curlCommand += ` \\\n  -H "Authorization: ${authHeader}"`;
            curlCommand += ` \\\n  -H "x-tos-date: ${amzDate}"`;
            curlCommand += ` \\\n  -H "x-tos-content-sha256: ${payloadHash}"`;
            
            // æ·»åŠ è‡ªå®šä¹‰headers
            if (customHeaders && customHeaders.length > 0) {
                customHeaders.forEach(header => {
                    curlCommand += ` \\\n  -H "${header.key}: ${header.value}"`;
                });
            }
            
            // æ·»åŠ Content-Typeï¼ˆå¦‚æœæœ‰è¯·æ±‚ä½“ï¼‰
            if (requestBody && method !== 'GET' && method !== 'HEAD') {
                // æ£€æŸ¥æ˜¯å¦å·²ç»æœ‰Content-Type header
                const hasContentType = customHeaders && customHeaders.some(h => 
                    h.key.toLowerCase() === 'content-type'
                );
                if (!hasContentType) {
                    curlCommand += ` \\\n  -H "Content-Type: application/json"`;
                }
                curlCommand += ` \\\n  -d '${requestBody}'`;
            }
            
            return curlCommand;
        }
        
        // å¤åˆ¶ cURL å‘½ä»¤åˆ°å‰ªè´´æ¿
        function copyCurl() {
            const curlText = document.getElementById('curlRequestOutput').textContent;
            copyToClipboard(curlText, 'copyCurlBtn', 'å¤åˆ¶ cURL å‘½ä»¤');
        }
        
        
        // ç»Ÿä¸€çš„ä»£ç å¤åˆ¶åŠŸèƒ½
        function copyCode(language) {
            const languageConfig = {
                python: {
                    elementId: 'pythonCodeOutput',
                    buttonId: 'copyPythonBtn',
                    buttonText: 'å¤åˆ¶ä»£ç '
                },
                golang: {
                    elementId: 'golangCodeOutput',
                    buttonId: 'copyGolangBtn',
                    buttonText: 'å¤åˆ¶ä»£ç '
                },
                java: {
                    elementId: 'javaCodeOutput',
                    buttonId: 'copyJavaBtn',
                    buttonText: 'å¤åˆ¶ä»£ç '
                },
                nodejs: {
                    elementId: 'nodejsCodeOutput',
                    buttonId: 'copyNodejsBtn',
                    buttonText: 'å¤åˆ¶ä»£ç '
                }
            };
            
            const config = languageConfig[language];
            if (!config) {
                console.error('Unknown language:', language);
                return;
            }
            
            const codeText = document.getElementById(config.elementId).textContent;
            copyToClipboard(codeText, config.buttonId, config.buttonText);
        }
        
        // ä¿æŒå‘åå…¼å®¹çš„å‡½æ•°
        function copyPythonCode() { copyCode('python'); }
        function copyGolangCode() { copyCode('golang'); }
        function copyJavaCode() { copyCode('java'); }
        function copyNodejsCode() { copyCode('nodejs'); }
        
        // é€šç”¨å¤åˆ¶åˆ°å‰ªè´´æ¿å‡½æ•°
        function copyToClipboard(text, buttonId, originalText) {
            if (navigator.clipboard && window.isSecureContext) {
                // ä½¿ç”¨ç°ä»£å‰ªè´´æ¿ API
                navigator.clipboard.writeText(text).then(() => {
                    showCopySuccess(buttonId, originalText);
                }).catch(err => {
                    console.error('å¤åˆ¶å¤±è´¥:', err);
                    fallbackCopy(text, buttonId, originalText);
                });
            } else {
                // é™çº§åˆ°ä¼ ç»Ÿæ–¹æ³•
                fallbackCopy(text, buttonId, originalText);
            }
        }
        
        // é™çº§å¤åˆ¶æ–¹æ³•
        function fallbackCopy(text, buttonId, originalText) {
            const textArea = document.createElement('textarea');
            textArea.value = text;
            textArea.style.position = 'fixed';
            textArea.style.left = '-999999px';
            textArea.style.top = '-999999px';
            document.body.appendChild(textArea);
            textArea.focus();
            textArea.select();
            
            try {
                document.execCommand('copy');
                showCopySuccess(buttonId, originalText);
            } catch (err) {
                console.error('å¤åˆ¶å¤±è´¥:', err);
                alert('å¤åˆ¶å¤±è´¥ï¼Œè¯·æ‰‹åŠ¨é€‰æ‹©å¹¶å¤åˆ¶æ–‡æœ¬');
            } finally {
                document.body.removeChild(textArea);
            }
        }

        // æ˜¾ç¤ºå¤åˆ¶æˆåŠŸåé¦ˆ
        function showCopySuccess(buttonId = 'copyCurlBtn', originalText = 'å¤åˆ¶ cURL å‘½ä»¤') {
            const btn = document.getElementById(buttonId);
            btn.textContent = 'å·²å¤åˆ¶!';
            btn.style.backgroundColor = 'var(--aws-green)';
            btn.style.color = 'white';
            
            setTimeout(() => {
                btn.textContent = originalText;
                btn.style.backgroundColor = '';
                btn.style.color = '';
            }, 2000);
        }

        // å¤„ç†Hostè¾“å…¥çš„è‡ªåŠ¨è§£æåŠŸèƒ½
        function processHostInput() {
            const hostInput = document.getElementById('host');
            const pathInput = document.getElementById('path');
            const infoDiv = document.getElementById('hostProcessInfo');
            
            let originalValue = hostInput.value;
            let processedValue = originalValue;
            let messages = [];
            
            // å¦‚æœè¾“å…¥ä¸ºç©ºï¼Œéšè—æç¤ºä¿¡æ¯
            if (!originalValue.trim()) {
                infoDiv.style.display = 'none';
                return;
            }
            
            // 1. å»é™¤ç©ºæ ¼ã€tabã€å›è½¦ç­‰æ— æ•ˆå­—ç¬¦
            processedValue = processedValue.replace(/[\s\t\r\n]/g, '');
            if (processedValue !== originalValue) {
                messages.push('å·²æ¸…ç†æ— æ•ˆç©ºç™½å­—ç¬¦');
            }
            
            // 2. å»é™¤http/httpså‰ç¼€
            const httpRegex = /^https?:\/\//i;
            if (httpRegex.test(processedValue)) {
                processedValue = processedValue.replace(httpRegex, '');
                messages.push('å·²ç§»é™¤HTTP/HTTPSå‰ç¼€');
            }
            
            // 3. æ£€æŸ¥æ˜¯å¦åŒ…å«è·¯å¾„å’ŒæŸ¥è¯¢å‚æ•°
            let hasPathOrQuery = false;
            let queryStringFound = '';
            
            // æ£€æŸ¥æ•´ä¸ªURLä¸­æ˜¯å¦åŒ…å«æŸ¥è¯¢å‚æ•°
            const questionMarkIndex = processedValue.indexOf('?');
            if (questionMarkIndex !== -1) {
                queryStringFound = processedValue.substring(questionMarkIndex + 1);
                processedValue = processedValue.substring(0, questionMarkIndex);
            }
            
            const urlParts = processedValue.split('/');
            const hostPart = urlParts[0];
            
            if (urlParts.length > 1) {
                // æå–è·¯å¾„éƒ¨åˆ†
                const pathPart = '/' + urlParts.slice(1).join('/');
                
                // è®¾ç½®å¤„ç†åçš„host
                processedValue = hostPart;
                hasPathOrQuery = true;
                
                // è‡ªåŠ¨å¡«å……è·¯å¾„
                if (pathPart && pathPart !== '/') {
                    pathInput.value = pathPart;
                    messages.push(`å·²è‡ªåŠ¨å¡«å……Path: ${pathPart}`);
                } else {
                    // å¦‚æœè·¯å¾„æ˜¯æ ¹è·¯å¾„ï¼Œç¡®ä¿Pathå­—æ®µä¸º'/'
                    pathInput.value = '/';
                }
            }
            
            // å¤„ç†æŸ¥è¯¢å‚æ•° - æ— è®ºæ˜¯å¦æœ‰è·¯å¾„ï¼Œéƒ½è¦å¤„ç†æŸ¥è¯¢å‚æ•°
            if (questionMarkIndex !== -1 || hasPathOrQuery) {
                if (queryStringFound) {
                    parseAndFillQueryParams(queryStringFound);
                    messages.push(`å·²è‡ªåŠ¨å¡«å……Queryå‚æ•°: ${queryStringFound}`);
                } else {
                    // å¦‚æœæ£€æµ‹åˆ°URLæ ¼å¼ä½†æ²¡æœ‰queryå‚æ•°ï¼Œæ¸…ç©ºç°æœ‰å‚æ•°
                    clearQueryParams();
                    messages.push('å·²æ¸…ç©ºQueryå‚æ•°');
                }
            }
            
            // 4. å»é™¤å°¾éƒ¨çš„æ–œæ ï¼ˆå¦‚æœæœ‰ï¼‰
            if (processedValue.endsWith('/')) {
                processedValue = processedValue.slice(0, -1);
                messages.push('å·²ç§»é™¤å°¾éƒ¨æ–œæ ');
            }
            
            // æ›´æ–°Hostè¾“å…¥æ¡†çš„å€¼
            if (processedValue !== originalValue) {
                hostInput.value = processedValue;
            }
            
            // æ˜¾ç¤ºå¤„ç†ä¿¡æ¯
            if (messages.length > 0) {
                infoDiv.innerHTML = `
                    <button class="host-process-close" onclick="closeHostProcessInfo()" title="å…³é—­">Ã—</button>
                    <div class="original-url">åŸå§‹è¾“å…¥: ${originalValue}</div>
                    <div class="process-details">âœ… å·²è‡ªåŠ¨å¤„ç†: ${messages.join(', ')}</div>
                `;
                infoDiv.style.display = 'block';
                // ä¸å†è‡ªåŠ¨éšè—æç¤ºï¼Œä¿æŒæ˜¾ç¤ºçŠ¶æ€
            } else {
                infoDiv.style.display = 'none';
            }
        }
        
        // è§£æå¹¶å¡«å……æŸ¥è¯¢å‚æ•°
        function parseAndFillQueryParams(queryString) {
            const container = document.getElementById('queryParams');
            
            // æ¸…ç©ºç°æœ‰çš„æŸ¥è¯¢å‚æ•°
            container.innerHTML = '';
            
            // è§£ææŸ¥è¯¢å­—ç¬¦ä¸²
            const params = queryString.split('&');
            
            params.forEach(param => {
                const [key, value = ''] = param.split('=');
                if (key) {
                    // åˆ›å»ºæ–°çš„å‚æ•°è¡Œ
                    const paramRow = document.createElement('div');
                    paramRow.className = 'param-row';
                    paramRow.innerHTML = `
                        <input class="form-input param-key" type="text" placeholder="å‚æ•°å" value="${decodeURIComponent(key)}">
                        <input class="form-input param-value" type="text" placeholder="å‚æ•°å€¼" value="${decodeURIComponent(value)}">
                        <button type="button" class="btn btn-danger btn-sm" onclick="removeParam(this)">åˆ é™¤</button>
                    `;
                    container.appendChild(paramRow);
                }
            });
            
            // å¦‚æœæ²¡æœ‰å‚æ•°æˆ–åªæœ‰ç©ºå‚æ•°ï¼Œæ·»åŠ ä¸€ä¸ªç©ºè¡Œ
            if (container.children.length === 0) {
                addEmptyParamRow();
            }
        }
        
        // æ¸…ç©ºæŸ¥è¯¢å‚æ•°
        function clearQueryParams() {
            const container = document.getElementById('queryParams');
            container.innerHTML = '';
            addEmptyParamRow();
        }
        
        // æ·»åŠ ç©ºçš„å‚æ•°è¡Œ
        function addEmptyParamRow() {
            const container = document.getElementById('queryParams');
            const paramRow = document.createElement('div');
            paramRow.className = 'param-row';
            paramRow.innerHTML = `
                <input class="form-input param-key" type="text" placeholder="å‚æ•°å">
                <input class="form-input param-value" type="text" placeholder="å‚æ•°å€¼">
                <button type="button" class="btn btn-danger btn-sm" onclick="removeParam(this)">åˆ é™¤</button>
            `;
            container.appendChild(paramRow);
        }

        // å…³é—­Hostå¤„ç†ä¿¡æ¯æç¤ºæ¡†
        function closeHostProcessInfo() {
            const infoDiv = document.getElementById('hostProcessInfo');
            infoDiv.style.display = 'none';
        }

        // æ£€æŸ¥HTTP Methodå’ŒRequest Bodyçš„å†²çª
        function checkMethodBodyConflict() {
            const method = document.getElementById('method').value;
            const requestBody = document.getElementById('requestBody').value;
            const warningDiv = document.getElementById('methodBodyWarning');
            
            // å¦‚æœæ˜¯GETæˆ–HEADæ–¹æ³•ï¼Œä¸”æœ‰Request Bodyå†…å®¹ï¼Œæ˜¾ç¤ºè­¦å‘Š
            if ((method === 'GET' || method === 'HEAD') && requestBody.trim()) {
                warningDiv.style.display = 'block';
                if (method === 'HEAD') {
                    warningDiv.textContent = 'âš ï¸ é€šå¸¸æ˜¯ POST æˆ– PUT Method ä½¿ç”¨ Bodyï¼Œå½“å‰Methodä¸º HEAD ï¼Œè¯·ä»”ç»†ç¡®è®¤';
                } else {
                    warningDiv.textContent = 'âš ï¸ é€šå¸¸æ˜¯ POST æˆ– PUT Method ä½¿ç”¨ Bodyï¼Œå½“å‰Methodä¸º GET ï¼Œè¯·ä»”ç»†ç¡®è®¤';
                }
            } else {
                warningDiv.style.display = 'none';
            }
        }

        document.getElementById('signatureForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            await calculateSignature();
        });
    </script>
</body>
</html>