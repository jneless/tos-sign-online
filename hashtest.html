<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>JSON Hash 测试工具</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.2.0/crypto-js.min.js"></script>
    <style>
        :root {
            --aws-blue: #232f3e;
            --aws-orange: #ff9900;
            --aws-light-blue: #146eb4;
            --aws-gray-50: #fafafa;
            --aws-gray-100: #f2f3f3;
            --aws-gray-200: #eaeded;
            --aws-gray-300: #d5dbdb;
            --aws-gray-700: #34495e;
            --aws-gray-800: #2c3e50;
            --aws-white: #ffffff;
            --aws-green: #037f0c;
            --aws-red: #d13212;
            --aws-border: #d5dbdb;
        }

        * {
            box-sizing: border-box;
        }

        body {
            font-family: 'Amazon Ember', 'Helvetica Neue', Roboto, Arial, sans-serif;
            margin: 0;
            padding: 20px;
            background-color: var(--aws-gray-50);
            color: var(--aws-gray-800);
            line-height: 1.5;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
        }

        .header {
            text-align: center;
            margin-bottom: 30px;
            background: var(--aws-white);
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .header h1 {
            color: var(--aws-blue);
            margin: 0;
            font-size: 28px;
        }

        .header p {
            color: var(--aws-gray-700);
            margin: 10px 0 0;
        }

        .main-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 20px;
            /* 确保网格列宽度固定，防止内容溢出 */
            overflow: hidden;
        }

        .input-section, .output-section {
            background: var(--aws-white);
            border: 1px solid var(--aws-border);
            border-radius: 8px;
            padding: 20px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            /* 防止内容溢出 */
            min-width: 0; /* 允许flex/grid子项收缩 */
            overflow: hidden;
        }

        .section-title {
            font-size: 18px;
            font-weight: 600;
            color: var(--aws-gray-800);
            margin: 0 0 15px 0;
            padding-bottom: 8px;
            border-bottom: 2px solid var(--aws-gray-200);
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-label {
            display: block;
            margin-bottom: 5px;
            font-weight: 600;
            color: var(--aws-gray-700);
        }

        .form-textarea {
            width: 100%;
            height: 200px;
            padding: 12px;
            border: 1px solid var(--aws-border);
            border-radius: 4px;
            font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace;
            font-size: 13px;
            background-color: var(--aws-white);
            color: var(--aws-gray-800);
            resize: vertical;
        }

        .form-textarea:focus {
            outline: none;
            border-color: var(--aws-light-blue);
            box-shadow: 0 0 0 2px rgba(20, 110, 180, 0.2);
        }

        .btn {
            background-color: var(--aws-orange);
            color: var(--aws-white);
            border: none;
            border-radius: 4px;
            padding: 10px 20px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: background-color 0.2s;
        }

        .btn:hover {
            background-color: #e88400;
        }

        .output-grid {
            display: grid;
            grid-template-columns: 1fr;
            gap: 15px;
        }

        .hash-result {
            padding: 15px;
            border-radius: 6px;
            border: 1px solid var(--aws-border);
            background-color: var(--aws-gray-50);
        }

        .hash-result.original {
            border-left: 4px solid var(--aws-green);
        }

        .hash-result.compressed {
            border-left: 4px solid var(--aws-light-blue);
        }

        .hash-title {
            font-weight: 600;
            margin-bottom: 8px;
            font-size: 14px;
        }

        .hash-title.original {
            color: var(--aws-green);
        }

        .hash-title.compressed {
            color: var(--aws-light-blue);
        }

        .hash-value {
            font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace;
            font-size: 12px;
            word-break: break-all;
            background: var(--aws-white);
            padding: 8px;
            border-radius: 4px;
            border: 1px solid var(--aws-border);
            margin-bottom: 8px;
            /* 确保hash值不会撑开容器 */
            overflow-wrap: break-word;
            max-width: 100%;
            min-width: 0;
        }

        .hash-info {
            font-size: 12px;
            color: var(--aws-gray-700);
        }

        .json-preview {
            background: var(--aws-gray-100);
            padding: 10px;
            border-radius: 4px;
            font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace;
            font-size: 12px;
            /* 修复换行显示问题 */
            white-space: pre-wrap; /* 保持换行但允许长行换行 */
            word-wrap: break-word; /* 强制长单词换行 */
            word-break: break-all; /* 允许在任意字符间换行 */
            max-height: 200px; /* 增加高度限制 */
            overflow-y: auto;
            overflow-x: hidden; /* 隐藏横向滚动 */
            margin-bottom: 8px;
            /* 确保不会撑开容器 */
            min-width: 0;
            max-width: 100%;
            border: 1px solid var(--aws-border);
        }

        .error {
            color: var(--aws-red);
            background: #ffeaea;
            border: 1px solid #ffcdd2;
            padding: 10px;
            border-radius: 4px;
            font-size: 14px;
        }

        .examples-section {
            background: var(--aws-white);
            border: 1px solid var(--aws-border);
            border-radius: 8px;
            padding: 20px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .example-item {
            background: var(--aws-gray-50);
            border: 1px solid var(--aws-border);
            border-radius: 4px;
            padding: 10px;
            margin-bottom: 10px;
            cursor: pointer;
            transition: background-color 0.2s;
        }

        .example-item:hover {
            background: var(--aws-gray-100);
        }

        .example-title {
            font-weight: 600;
            margin-bottom: 5px;
        }

        .example-json {
            font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace;
            font-size: 12px;
            color: var(--aws-gray-700);
        }

        .json-full-display {
            background: var(--aws-gray-50);
            border: 1px solid var(--aws-border);
            border-radius: 4px;
            padding: 15px;
            font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace;
            font-size: 13px;
            white-space: pre-wrap;
            word-wrap: break-word;
            max-height: 400px;
            overflow-y: auto;
            overflow-x: hidden;
            line-height: 1.4;
            color: var(--aws-gray-800);
        }

        @media (max-width: 768px) {
            .main-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>JSON Hash 测试工具</h1>
            <p>测试JSON原始格式与压缩格式的SHA256哈希值差异</p>
        </div>

        <div class="main-grid">
            <!-- 输入区域 -->
            <div class="input-section">
                <div class="section-title">JSON 输入</div>
                
                <div class="form-group">
                    <label class="form-label" for="jsonInput">请输入JSON数据：</label>
                    <textarea 
                        class="form-textarea" 
                        id="jsonInput" 
                        placeholder="输入您的JSON数据，保持原有格式..."
                        oninput="calculateHashes()"
                    ></textarea>
                </div>

                <button class="btn" onclick="calculateHashes()">计算哈希值</button>
            </div>

            <!-- 输出区域 -->
            <div class="output-section">
                <div class="section-title">哈希结果对比</div>
                
                <div class="output-grid">
                    <!-- 原始格式哈希 -->
                    <div class="hash-result original">
                        <div class="hash-title original">原始格式 SHA256</div>
                        <div class="json-preview" id="originalPreview">等待输入...</div>
                        <div class="hash-value" id="originalHash">-</div>
                        <div class="hash-info">保持用户输入的所有格式（换行、缩进、空格）</div>
                    </div>

                    <!-- 压缩格式哈希 -->
                    <div class="hash-result compressed">
                        <div class="hash-title compressed">压缩格式 SHA256</div>
                        <div class="json-preview" id="compressedPreview">等待输入...</div>
                        <div class="hash-value" id="compressedHash">-</div>
                        <div class="hash-info">移除多余空格和换行，标准JSON格式</div>
                    </div>
                </div>

                <div id="errorMessage"></div>
            </div>
        </div>

        <!-- 完整压缩JSON显示区域 -->
        <div class="examples-section" id="fullJsonSection" style="display: none;">
            <div class="section-title">完整压缩JSON</div>
            <div style="margin-bottom: 15px;">
                <button class="btn" onclick="toggleFullJson()" id="toggleBtn">展开压缩JSON</button>
                <span style="margin-left: 10px; color: var(--aws-gray-700); font-size: 12px;">显示完整的压缩后JSON内容</span>
            </div>
            <div class="json-full-display" id="fullJsonContent">
                等待输入JSON...
            </div>
        </div>

        <!-- 示例区域 -->
        <div class="examples-section">
            <div class="section-title">示例JSON</div>
            <p style="margin-bottom: 15px; color: var(--aws-gray-700);">点击下面的示例快速测试：</p>
            
            <div class="example-item" onclick="loadExample(1)">
                <div class="example-title">示例 1：带缩进的简单对象</div>
                <div class="example-json">{"a":"a","b":"b"} (带换行和缩进)</div>
            </div>

            <div class="example-item" onclick="loadExample(2)">
                <div class="example-title">示例 2：嵌套对象</div>
                <div class="example-json">包含嵌套对象和数组的复杂JSON</div>
            </div>

            <div class="example-item" onclick="loadExample(3)">
                <div class="example-title">示例 3：紧凑格式</div>
                <div class="example-json">无多余空格的单行JSON</div>
            </div>
        </div>
    </div>

    <script>
        // 示例数据
        const examples = {
            1: `{
    "a": "a",
    "b": "b"
}`,
            2: `{
    "user": {
        "name": "张三",
        "age": 30,
        "address": {
            "city": "北京",
            "district": "朝阳区"
        }
    },
    "items": [
        {"id": 1, "name": "商品A"},
        {"id": 2, "name": "商品B"}
    ]
}`,
            3: `{"compact":true,"spaces":false,"newlines":false}`
        };

        // 加载示例
        function loadExample(exampleId) {
            document.getElementById('jsonInput').value = examples[exampleId];
            calculateHashes();
        }

        // 计算哈希值
        function calculateHashes() {
            const jsonInput = document.getElementById('jsonInput').value;
            const errorDiv = document.getElementById('errorMessage');
            
            // 清除之前的错误信息
            errorDiv.innerHTML = '';

            if (!jsonInput.trim()) {
                // 清空显示
                document.getElementById('originalPreview').textContent = '等待输入...';
                document.getElementById('compressedPreview').textContent = '等待输入...';
                document.getElementById('originalHash').textContent = '-';
                document.getElementById('compressedHash').textContent = '-';
                updateFullJsonDisplay(''); // 清空完整JSON显示
                return;
            }

            try {
                // 1. 原始格式哈希计算
                const originalHash = CryptoJS.SHA256(jsonInput).toString(CryptoJS.enc.Hex);
                document.getElementById('originalHash').textContent = originalHash;
                document.getElementById('originalPreview').textContent = jsonInput.length > 200 ? 
                    jsonInput.substring(0, 200) + '...' : jsonInput;

                // 暂时不更新完整JSON显示，等待压缩JSON计算完成

                // 2. 尝试解析JSON并压缩
                let compressedJson = '';
                let compressedHash = '';
                
                try {
                    const parsedJson = JSON.parse(jsonInput);
                    compressedJson = JSON.stringify(parsedJson);
                    compressedHash = CryptoJS.SHA256(compressedJson).toString(CryptoJS.enc.Hex);
                    
                    document.getElementById('compressedHash').textContent = compressedHash;
                    document.getElementById('compressedPreview').textContent = compressedJson.length > 200 ? 
                        compressedJson.substring(0, 200) + '...' : compressedJson;

                    // 更新完整压缩JSON显示
                    updateFullJsonDisplay(compressedJson);

                    // 显示差异信息
                    if (originalHash === compressedHash) {
                        showInfo('✅ 两种格式的哈希值相同', 'success');
                    } else {
                        showInfo('⚠️ 两种格式的哈希值不同', 'warning');
                    }

                } catch (parseError) {
                    // JSON解析失败
                    document.getElementById('compressedHash').textContent = '无法解析JSON';
                    document.getElementById('compressedPreview').textContent = '输入的不是有效的JSON格式';
                    updateFullJsonDisplay(''); // 清空完整JSON显示
                    showError('JSON格式错误: ' + parseError.message);
                }

            } catch (error) {
                showError('计算哈希时出错: ' + error.message);
            }
        }

        // 显示错误信息
        function showError(message) {
            const errorDiv = document.getElementById('errorMessage');
            errorDiv.innerHTML = `<div class="error">${message}</div>`;
        }

        // 显示信息
        function showInfo(message, type) {
            const errorDiv = document.getElementById('errorMessage');
            const className = type === 'success' ? 'success' : 'warning';
            const bgColor = type === 'success' ? '#e8f5e8' : '#fff3cd';
            const borderColor = type === 'success' ? '#4caf50' : '#ff9900';
            const textColor = type === 'success' ? '#2e7d32' : '#856404';
            
            errorDiv.innerHTML = `
                <div style="
                    background: ${bgColor}; 
                    border: 1px solid ${borderColor}; 
                    color: ${textColor}; 
                    padding: 10px; 
                    border-radius: 4px; 
                    margin-top: 15px;
                    font-size: 14px;
                ">${message}</div>
            `;
        }

        // 更新完整压缩JSON显示
        function updateFullJsonDisplay(compressedJson) {
            const fullJsonSection = document.getElementById('fullJsonSection');
            const fullJsonContent = document.getElementById('fullJsonContent');
            
            if (compressedJson && compressedJson.trim()) {
                fullJsonContent.textContent = compressedJson;
                
                // 如果压缩JSON很长，自动显示完整区域
                if (compressedJson.length > 200) {
                    fullJsonSection.style.display = 'block';
                    document.getElementById('toggleBtn').textContent = '收起压缩JSON';
                } else {
                    // 短JSON默认隐藏，但可以手动展开
                    fullJsonSection.style.display = 'none';
                    document.getElementById('toggleBtn').textContent = '展开压缩JSON';
                }
            } else {
                fullJsonSection.style.display = 'none';
                fullJsonContent.textContent = '等待输入有效JSON...';
                document.getElementById('toggleBtn').textContent = '展开压缩JSON';
            }
        }

        // 切换完整压缩JSON显示
        function toggleFullJson() {
            const fullJsonSection = document.getElementById('fullJsonSection');
            const toggleBtn = document.getElementById('toggleBtn');
            
            if (fullJsonSection.style.display === 'none') {
                fullJsonSection.style.display = 'block';
                toggleBtn.textContent = '收起压缩JSON';
            } else {
                fullJsonSection.style.display = 'none';
                toggleBtn.textContent = '展开压缩JSON';
            }
        }

        // 页面加载时加载默认示例
        window.addEventListener('DOMContentLoaded', function() {
            loadExample(1);
        });
    </script>
</body>
</html>